<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gsw.gibbs.practical_salinity &#8212; gsw  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for gsw.gibbs.practical_salinity</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">.library</span> <span class="k">import</span> <span class="n">Hill_ratio_at_SP2</span>
<span class="kn">from</span> <span class="nn">..utilities</span> <span class="k">import</span> <span class="n">match_args_return</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C_from_SP&#39;</span><span class="p">,</span>
           <span class="s1">&#39;R_from_SP&#39;</span><span class="p">,</span>
           <span class="s1">&#39;SK_from_SP&#39;</span><span class="p">,</span>
           <span class="s1">&#39;SP_from_C&#39;</span><span class="p">,</span>
           <span class="s1">&#39;SP_from_R&#39;</span><span class="p">,</span>
           <span class="s1">&#39;SP_from_SK&#39;</span><span class="p">,</span>
           <span class="s1">&#39;SP_salinometer&#39;</span><span class="p">]</span>

<span class="c1"># Constants.</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0080</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1692</span><span class="p">,</span> <span class="mf">25.3851</span><span class="p">,</span> <span class="mf">14.0941</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0261</span><span class="p">,</span> <span class="mf">2.7081</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0005</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0056</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0066</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0375</span><span class="p">,</span> <span class="mf">0.0636</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0144</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6766097</span><span class="p">,</span> <span class="mf">2.00564e-2</span><span class="p">,</span> <span class="mf">1.104259e-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.9698e-7</span><span class="p">,</span> <span class="mf">1.0031e-9</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.426e-2</span><span class="p">,</span> <span class="mf">4.464e-4</span><span class="p">,</span> <span class="mf">4.215e-1</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.107e-3</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.070e-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.370e-10</span><span class="p">,</span> <span class="mf">3.989e-15</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.577801212923119e-3</span><span class="p">,</span> <span class="mf">1.924049429136640e-1</span><span class="p">,</span> <span class="mf">2.183871685127932e-5</span><span class="p">,</span>
     <span class="o">-</span><span class="mf">7.292156330457999e-3</span><span class="p">,</span> <span class="mf">1.568129536470258e-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.478995271680869e-6</span><span class="p">,</span>
     <span class="mf">9.086442524716395e-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.949560839540487e-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.223058111118377e-6</span><span class="p">,</span>
     <span class="mf">1.175871639741131e-7</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.522895856600089e-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.254458513439107e-6</span><span class="p">,</span>
     <span class="mf">6.179992190192848e-7</span><span class="p">,</span> <span class="mf">1.005054226996868e-8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.923745566122602e-9</span><span class="p">,</span>
     <span class="mf">2.259550611212616e-6</span><span class="p">,</span> <span class="mf">1.631749165091437e-7</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.931857989915256e-9</span><span class="p">,</span>
     <span class="o">-</span><span class="mf">4.693392029005252e-9</span><span class="p">,</span> <span class="mf">2.571854839274148e-10</span><span class="p">,</span> <span class="mf">4.198786822861038e-12</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="mf">5.540896868127855e-5</span><span class="p">,</span> <span class="mf">2.015419291097848e-1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.445310045430192e-5</span><span class="p">,</span>
     <span class="o">-</span><span class="mf">1.567047628411722e-2</span><span class="p">,</span> <span class="mf">2.464756294660119e-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.575458304732166e-7</span><span class="p">,</span>
     <span class="mf">5.071449842454419e-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.081985795339206e-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.635420818812898e-6</span><span class="p">,</span>
     <span class="mf">2.249490528450555e-8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.143810377431888e-3</span><span class="p">,</span> <span class="mf">2.066112484281530e-5</span><span class="p">,</span>
     <span class="mf">7.482907137737503e-7</span><span class="p">,</span> <span class="mf">4.019321577844724e-8</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.755568141370501e-10</span><span class="p">,</span>
     <span class="mf">1.120748754429459e-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.420274029674485e-6</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.774829347564670e-8</span><span class="p">,</span>
     <span class="o">-</span><span class="mf">4.279037686797859e-9</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.045829202713288e-10</span><span class="p">,</span> <span class="mf">5.025109163112005e-12</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.432285006604888e-3</span><span class="p">,</span> <span class="mf">1.672940491817403e-1</span><span class="p">,</span> <span class="mf">2.640304401023995e-5</span><span class="p">,</span>
     <span class="mf">1.082267090441036e-1</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.296778883666940e-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.542775152303671e-7</span><span class="p">,</span>
     <span class="o">-</span><span class="mf">1.859711038699727e-1</span><span class="p">,</span> <span class="mf">7.659006320303959e-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.794661268817618e-7</span><span class="p">,</span>
     <span class="mf">8.093368602891911e-9</span><span class="p">,</span> <span class="mf">1.001140606840692e-1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.038712945546608e-3</span><span class="p">,</span>
     <span class="o">-</span><span class="mf">6.227915160991074e-6</span><span class="p">,</span> <span class="mf">2.798564479737090e-8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.343623657549961e-10</span><span class="p">,</span>
     <span class="mf">1.024345179842964e-2</span><span class="p">,</span> <span class="mf">4.981135430579384e-4</span><span class="p">,</span> <span class="mf">4.466087528793912e-6</span><span class="p">,</span>
     <span class="mf">1.960872795577774e-8</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.723159418888634e-10</span><span class="p">,</span> <span class="mf">1.122200786423241e-12</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="mf">5.180529787390576e-3</span><span class="p">,</span> <span class="mf">1.052097167201052e-3</span><span class="p">,</span> <span class="mf">3.666193708310848e-5</span><span class="p">,</span>
     <span class="mf">7.112223828976632</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.631366777096209e-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.336295318742821e-7</span><span class="p">,</span>
     <span class="o">-</span><span class="mf">1.576886793288888e+2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.840239113483083e-3</span><span class="p">,</span> <span class="mf">8.624279120240952e-6</span><span class="p">,</span>
     <span class="mf">1.233529799729501e-8</span><span class="p">,</span> <span class="mf">1.826482800939545e+3</span><span class="p">,</span> <span class="mf">1.633903983457674e-1</span><span class="p">,</span>
     <span class="o">-</span><span class="mf">9.201096427222349e-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.187900959754842e-8</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.442010369809705e-10</span><span class="p">,</span>
     <span class="o">-</span><span class="mf">8.542357182595853e+3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.408635241899082</span><span class="p">,</span> <span class="mf">1.660164829963661e-4</span><span class="p">,</span>
     <span class="mf">6.797409608973845e-7</span><span class="p">,</span> <span class="mf">3.345074990451475e-10</span><span class="p">,</span> <span class="mf">8.285687652694768e-13</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">0.0162</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>


<div class="viewcode-block" id="C_from_SP"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.gibbs.practical_salinity.C_from_SP">[docs]</a><span class="k">def</span> <span class="nf">C_from_SP</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates conductivity, C, from (SP, t, p) using PSS-78 in the range</span>
<span class="sd">    2 &lt; SP &lt; 42. If the input Practical Salinity is less than 2 then a modified</span>
<span class="sd">    form of the Hill et al. (1986) fomula is used for Practical Salinity. The</span>
<span class="sd">    modification of the Hill et al. (1986) expression is to ensure that it is</span>
<span class="sd">    exactly consistent with PSS-78 at SP = 2.</span>

<span class="sd">    The conductivity ratio returned by this function is consistent with the</span>
<span class="sd">    input value of Practical Salinity, SP, to 2x10^-14 psu over the full range</span>
<span class="sd">    of input parameters (from pure fresh water up to SP = 42 psu). This error</span>
<span class="sd">    of 2x10^-14 psu is machine precision at typical seawater salinities.  This</span>
<span class="sd">    accuracy is achieved by having four different polynomials for the starting</span>
<span class="sd">    value of Rtx (the square root of Rt) in four different ranges of SP, and by</span>
<span class="sd">    using one and a half iterations of a computationally efficient modified</span>
<span class="sd">    Newton-Raphson technique to find the root of the equation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SP : array</span>
<span class="sd">         Practical Salinity [psu (PSS-78), unitless]</span>
<span class="sd">    t : array</span>
<span class="sd">        in-situ temperature [:math:`^\circ` C (ITS-90)]</span>
<span class="sd">    p : array</span>
<span class="sd">        sea pressure [dbar]</span>
<span class="sd">        (i.e. absolute pressure - 10.1325 dbar)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    C : array</span>
<span class="sd">        conductivity [mS cm :sup:`-1`]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Note that strictly speaking PSS-78 (Unesco, 1983) defines Practical</span>
<span class="sd">    Salinity in terms of the conductivity ratio, R, without actually</span>
<span class="sd">    specifying the value of C(35,15,0) (which we currently take to be</span>
<span class="sd">    42.9140 mS/cm).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    TODO</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Hill, K.D., T.M. Dauphinee and D.J. Woods, 1986: The extension of</span>
<span class="sd">       the Practical Salinity Scale 1978 to low salinities. IEEE J. Oceanic</span>
<span class="sd">       Eng., OE-11, 1, 109 - 112.</span>

<span class="sd">    .. [2] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp. See appendix E.</span>

<span class="sd">    .. [3] Unesco, 1983: Algorithms for computation of fundamental properties</span>
<span class="sd">       of seawater.  Unesco Technical Papers in Marine Science, 44, 53 pp.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">C</span> <span class="o">=</span> <span class="mf">42.9140</span> <span class="o">*</span> <span class="n">R_from_SP</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">C</span></div>


<span class="nd">@match_args_return</span>
<div class="viewcode-block" id="R_from_SP"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.gibbs.practical_salinity.R_from_SP">[docs]</a><span class="k">def</span> <span class="nf">R_from_SP</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates conductivity ratio from (SP, t, p) using PSS-78 in the range</span>
<span class="sd">    2 &lt; SP &lt; 42.  If the input Practical Salinity is less than 2 then a</span>
<span class="sd">    modified form of the Hill et al. (1986) formula is used for Practical</span>
<span class="sd">    Salinity.  The modification of the Hill et al. (1986) expression is to</span>
<span class="sd">    ensure that it is exactly consistent with PSS-78 at SP = 2.</span>

<span class="sd">    The conductivity ratio returned by this function is consistent with the</span>
<span class="sd">    input value of Practical Salinity, SP, to 2x10^-14 psu over the full range</span>
<span class="sd">    of input parameters (from pure fresh water up to SP = 42 psu).  This error</span>
<span class="sd">    of 2x10^-14 psu is machine precision at typical seawater salinities.  This</span>
<span class="sd">    accuracy is achieved by having four different polynomials for the starting</span>
<span class="sd">    value of Rtx (the square root of Rt) in four different ranges of SP, and by</span>
<span class="sd">    using one and a half iterations of a computationally efficient modified</span>
<span class="sd">    Newton-Raphson technique to find the root of the equation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SP : array</span>
<span class="sd">         Practical Salinity [psu (PSS-78), unitless]</span>
<span class="sd">    t : array_like</span>
<span class="sd">        in-situ temperature [:math:`^\circ` C (ITS-90)]</span>
<span class="sd">    p : array</span>
<span class="sd">        sea pressure [dbar]</span>
<span class="sd">        (i.e. absolute pressure - 10.1325 dbar)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R : array_like</span>
<span class="sd">        conductivity ratio [unitless]</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    TODO</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Strictly speaking PSS-78 (Unesco, 1983) defines Practical Salinity in terms</span>
<span class="sd">    of the conductivity ratio, R, without actually specifying the value of</span>
<span class="sd">    C(35, 15, 0) (which we currently take to be 42.9140 mS cm^-1.</span>
<span class="sd">    Culkin and Smith, 1980).</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Culkin and Smith, 1980:  Determination of the Concentration of</span>
<span class="sd">       Potassium Chloride Solution Having the Same Electrical Conductivity, at</span>
<span class="sd">       15C and Infinite Frequency, as Standard Seawater of Salinity 35.0000</span>
<span class="sd">       (Chlorinity 19.37394), IEEE J. Oceanic Eng, 5, 22-23.</span>

<span class="sd">    .. [2] Hill, K.D., T.M. Dauphinee &amp; D.J. Woods, 1986: The extension of the</span>
<span class="sd">       Practical Salinity Scale 1978 to low salinities. IEEE J. Oceanic Eng.,</span>
<span class="sd">       11, 109 - 112.</span>

<span class="sd">    .. [3] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp.  Appendix E.</span>

<span class="sd">    .. [4] Unesco, 1983: Algorithms for computation of fundamental properties</span>
<span class="sd">       of seawater.  Unesco Technical Papers in Marine Science, 44, 53 pp.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># These few lines ensure that SP is non-negative.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SP</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;R_from_SP: SP must be non-negative!&#39;</span><span class="p">)</span>

    <span class="n">SP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="c1"># Setting up the constants</span>
    <span class="n">t68</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="mf">1.00024</span>
    <span class="n">ft68</span> <span class="o">=</span> <span class="p">(</span><span class="n">t68</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">t68</span> <span class="o">-</span> <span class="mi">15</span><span class="p">))</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
    <span class="n">Rtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

    <span class="c1"># Finding the starting value of Rtx, the square root of Rt, using four</span>
    <span class="c1"># different polynomials of SP and t68.</span>
    <span class="c1"># TODO: Test case that cover all those &quot;ifs&quot;</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">SP</span> <span class="o">&gt;=</span> <span class="mi">9</span>
    <span class="k">if</span> <span class="n">I</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">Rtx</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">P</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">P</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span>
                  <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">P</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span>
                  <span class="n">P</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">P</span><span class="p">[</span><span class="mi">15</span><span class="p">]))))</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>
                  <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">P</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span> <span class="o">+</span>
                  <span class="n">P</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span>
                  <span class="n">P</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">+</span> <span class="n">P</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">P</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">])))))</span>

    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">SP</span> <span class="o">&gt;=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">SP</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">I</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">Rtx</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span>
                  <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span>
                  <span class="n">q</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mi">15</span><span class="p">]))))</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>
                  <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span> <span class="o">+</span>
                  <span class="n">q</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span>
                  <span class="n">q</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">])))))</span>

    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">SP</span> <span class="o">&gt;=</span> <span class="mf">0.003</span><span class="p">,</span> <span class="n">SP</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">I</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">Rtx</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span>
                  <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span>
                  <span class="n">r</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="p">[</span><span class="mi">15</span><span class="p">]))))</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>
                  <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span> <span class="o">+</span>
                  <span class="n">r</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span>
                  <span class="n">r</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">])))))</span>

    <span class="n">I</span> <span class="o">=</span> <span class="n">SP</span> <span class="o">&lt;</span> <span class="mf">0.003</span>
    <span class="k">if</span> <span class="n">I</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">Rtx</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span>
                  <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span>
                  <span class="n">u</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="p">[</span><span class="mi">15</span><span class="p">]))))</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>
                  <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span> <span class="o">+</span>
                  <span class="n">u</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span>
                  <span class="n">u</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span> <span class="o">+</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">[</span><span class="n">I</span><span class="p">])))))</span>

    <span class="c1"># Finding the starting value of dSP_dRtx, the derivative of SP with</span>
    <span class="c1"># respect to Rtx.</span>
    <span class="n">dSP_dRtx</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span>
                <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span> <span class="o">+</span> <span class="n">ft68</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">))</span>

    <span class="c1"># TODO: Test case that cover all those &quot;ifs&quot;</span>
    <span class="n">I2</span> <span class="o">=</span> <span class="n">SP</span> <span class="o">&lt;</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">I2</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">sqrty</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>
        <span class="n">part1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">part2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span><span class="p">))</span>
        <span class="n">Hill_ratio</span> <span class="o">=</span> <span class="n">Hill_ratio_at_SP2</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">I2</span><span class="p">])</span>
        <span class="n">dSP_dRtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dSP_dRtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">800</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span>
                        <span class="p">(</span><span class="n">part1</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ft68</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">+</span>
                        <span class="mi">30</span> <span class="o">*</span> <span class="n">sqrty</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">part2</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">dSP_dRtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Hill_ratio</span> <span class="o">*</span> <span class="n">dSP_dRtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>

    <span class="sd">&quot;&quot;&quot;One iteration through the modified Newton-Raphson method achieves an</span>
<span class="sd">    error in Practical Salinity of about 10^-12 for all combinations of the</span>
<span class="sd">    inputs.  One and a half iterations of the modified Newton-Raphson method</span>
<span class="sd">    achieves a maximum error in terms of Practical Salinity of better than</span>
<span class="sd">    2x10^-14 everywhere.</span>

<span class="sd">    We recommend one and a half iterations of the modified Newton-Raphson</span>
<span class="sd">    method.&quot;&quot;&quot;</span>

    <span class="c1"># Begin the modified Newton-Raphson method.</span>
    <span class="n">SP_est</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span>
              <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span> <span class="o">+</span> <span class="n">ft68</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span>
              <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">))</span>

    <span class="c1"># TODO: Test case that cover all those &quot;ifs&quot;</span>
    <span class="n">I2</span> <span class="o">=</span> <span class="n">SP_est</span> <span class="o">&lt;</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">I2</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">sqrty</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>
        <span class="n">part1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">part2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span><span class="p">))</span>
        <span class="n">SP_Hill_raw</span> <span class="o">=</span> <span class="n">SP_est</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">part1</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ft68</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">/</span> <span class="n">part2</span>
        <span class="n">Hill_ratio</span> <span class="o">=</span> <span class="n">Hill_ratio_at_SP2</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">I2</span><span class="p">])</span>
        <span class="n">SP_est</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Hill_ratio</span> <span class="o">*</span> <span class="n">SP_Hill_raw</span>

    <span class="n">Rtx_old</span> <span class="o">=</span> <span class="n">Rtx</span>
    <span class="n">Rtx</span> <span class="o">=</span> <span class="n">Rtx_old</span> <span class="o">-</span> <span class="p">(</span><span class="n">SP_est</span> <span class="o">-</span> <span class="n">SP</span><span class="p">)</span> <span class="o">/</span> <span class="n">dSP_dRtx</span>

    <span class="c1"># This mean value of Rtx, Rtxm, is the value of Rtx at which the</span>
    <span class="c1"># derivative dSP_dRtx is evaluated.</span>
    <span class="n">Rtxm</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rtx</span> <span class="o">+</span> <span class="n">Rtx_old</span><span class="p">)</span>

    <span class="n">dSP_dRtx</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span>
                 <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtxm</span> <span class="o">+</span> <span class="n">ft68</span> <span class="o">*</span>
                <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span>
                                     <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">))</span>

    <span class="c1"># TODO: Test case that cover all those &quot;ifs&quot;</span>
    <span class="n">I2</span> <span class="o">=</span> <span class="n">SP_est</span> <span class="o">&lt;</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">I2</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rtxm</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">sqrty</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>
        <span class="n">part1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">part2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span><span class="p">))</span>
        <span class="n">dSP_dRtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dSP_dRtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">800</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span>
                        <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">part1</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ft68</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span>
                        <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">sqrty</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">part2</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">Hill_ratio</span> <span class="o">=</span> <span class="n">Hill_ratio_at_SP2</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">I2</span><span class="p">])</span>
        <span class="n">dSP_dRtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Hill_ratio</span> <span class="o">*</span> <span class="n">dSP_dRtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>

    <span class="c1"># End of the one full iteration of the modified Newton-Raphson technique.</span>
    <span class="n">Rtx</span> <span class="o">=</span> <span class="n">Rtx_old</span> <span class="o">-</span> <span class="p">(</span><span class="n">SP_est</span> <span class="o">-</span> <span class="n">SP</span><span class="p">)</span> <span class="o">/</span> <span class="n">dSP_dRtx</span>  <span class="c1"># Updated Rtx</span>

    <span class="c1">#  Now we do another half iteration of the modified Newton-Raphson</span>
    <span class="c1">#  technique, making a total of one and a half modified N-R iterations.</span>
    <span class="n">SP_est</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span>
                              <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span> <span class="o">+</span> <span class="n">ft68</span> <span class="o">*</span>
              <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span>
                               <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">))</span>

    <span class="c1"># TODO: Test case that cover all those &quot;ifs&quot;</span>
    <span class="n">I2</span> <span class="o">=</span> <span class="n">SP_est</span> <span class="o">&lt;</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">I2</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">sqrty</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>
        <span class="n">part1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">part2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span><span class="p">))</span>
        <span class="n">SP_Hill_raw</span> <span class="o">=</span> <span class="n">SP_est</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">part1</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ft68</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">/</span> <span class="n">part2</span>
        <span class="n">Hill_ratio</span> <span class="o">=</span> <span class="n">Hill_ratio_at_SP2</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">I2</span><span class="p">])</span>
        <span class="n">SP_est</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Hill_ratio</span> <span class="o">*</span> <span class="n">SP_Hill_raw</span>

    <span class="n">Rtx</span> <span class="o">=</span> <span class="n">Rtx</span> <span class="o">-</span> <span class="p">(</span><span class="n">SP_est</span> <span class="o">-</span> <span class="n">SP</span><span class="p">)</span> <span class="o">/</span> <span class="n">dSP_dRtx</span>

    <span class="sd">&quot;&quot;&quot; TODO: add this as a kw.</span>
<span class="sd">    Return the error, SP_error, in Rtx (in terms of psu).</span>

<span class="sd">    SP_est = (a[0] + (a[1] + (a[2] + (a[3] + (a[4] + a[5] * Rtx) * Rtx) *</span>
<span class="sd">            Rtx) * Rtx) * Rtx + ft68 * (b[0] + (b[1] + (b[2] + (b[3] +</span>
<span class="sd">            (b[4] + b[5] * Rtx) * Rtx) * Rtx) * Rtx) * Rtx))</span>
<span class="sd">    I2 = SP_est &lt; 2</span>
<span class="sd">    if I2.any():</span>
<span class="sd">        x = 400 * (Rtx[I2] ** 2)</span>
<span class="sd">        sqrty = 10 * Rtx[I2]</span>
<span class="sd">        part1 = 1 + x * (1.5 + x)</span>
<span class="sd">        part2 = 1 + sqrty * (1 + sqrty * (1 + sqrty))</span>
<span class="sd">        SP_Hill_raw = SP_est[I2] - a[0] / part1 - b[0] * ft68[I2] / part2</span>
<span class="sd">        Hill_ratio = Hill_ratio_at_SP2(t[I2])</span>
<span class="sd">        SP_est[I2] = Hill_ratio * SP_Hill_raw</span>

<span class="sd">    SP_error = np.abs(SP - SP_est)</span>

<span class="sd">    This is the end of the error testing</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Now go from Rtx to Rt and then to the conductivity ratio R at pressure p.</span>
    <span class="n">Rt</span> <span class="o">=</span> <span class="n">Rtx</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># rt_lc (i.e. rt_lower_case) corresponds to rt as defined in the</span>
    <span class="c1"># UNESCO 44 (1983) routines.</span>
    <span class="n">rt_lc</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">)</span> <span class="o">*</span> <span class="n">t68</span><span class="p">)</span> <span class="o">*</span> <span class="n">t68</span><span class="p">)</span> <span class="o">*</span> <span class="n">t68</span>

    <span class="n">D</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span> <span class="o">*</span> <span class="n">rt_lc</span> <span class="o">*</span> <span class="n">Rt</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">rt_lc</span> <span class="o">*</span> <span class="n">Rt</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">Ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">E</span><span class="p">)</span> <span class="o">-</span> <span class="n">D</span>

    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ra</span> <span class="o">/</span> <span class="n">A</span></div>


<span class="nd">@match_args_return</span>
<div class="viewcode-block" id="SK_from_SP"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.gibbs.practical_salinity.SK_from_SP">[docs]</a><span class="k">def</span> <span class="nf">SK_from_SP</span><span class="p">(</span><span class="n">SP</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Knudsen Salinity from Practical Salinity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SP : array</span>
<span class="sd">         Practical Salinity [psu (PSS-78), unitless]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SK : array_like</span>
<span class="sd">         Knudsen Salinity [parts per thousand, ppt]</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    TODO</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp.  See Appendix A.3.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">SP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Ensure that SP is non-negative.</span>

    <span class="k">return</span> <span class="mf">0.03</span> <span class="o">+</span> <span class="n">SP</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.805</span> <span class="o">/</span> <span class="mf">1.80655</span><span class="p">)</span></div>


<span class="nd">@match_args_return</span>
<div class="viewcode-block" id="SP_from_C"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.gibbs.practical_salinity.SP_from_C">[docs]</a><span class="k">def</span> <span class="nf">SP_from_C</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Practical Salinity, SP, from conductivity, C, primarily</span>
<span class="sd">    using the PSS-78 algorithm.  Note that the PSS-78 algorithm for Practical</span>
<span class="sd">    Salinity is only valid in the range 2 &lt; SP &lt; 42.  If the PSS-78 algorithm</span>
<span class="sd">    produces a Practical Salinity that is less than 2 then the Practical</span>
<span class="sd">    Salinity is recalculated with a modified form of the Hill et al. (1986)</span>
<span class="sd">    formula. The modification of the Hill et al. (1986) expression is to ensure</span>
<span class="sd">    that it is exactly consistent with PSS-78 at SP = 2.  Note that the input</span>
<span class="sd">    values of conductivity need to be in units of mS/cm (not S/m).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    C : array</span>
<span class="sd">        conductivity [mS cm :sup:`-1`]</span>
<span class="sd">    t : array</span>
<span class="sd">        in-situ temperature [:math:`^\circ` C (ITS-90)]</span>
<span class="sd">    p : array</span>
<span class="sd">        sea pressure [dbar]</span>
<span class="sd">        (i.e. absolute pressure - 10.1325 dbar)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SP : array</span>
<span class="sd">         Practical Salinity [psu (PSS-78), unitless]</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    TODO</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Culkin and Smith, 1980:  Determination of the Concentration of</span>
<span class="sd">       Potassium Chloride Solution Having the Same Electrical Conductivity, at</span>
<span class="sd">       15C and Infinite Frequency, as Standard Seawater of Salinity 35.0000</span>
<span class="sd">       (Chlorinity 19.37394), IEEE J. Oceanic Eng, 5, 22-23.</span>

<span class="sd">    .. [2] Hill, K.D., T.M. Dauphinee &amp; D.J. Woods, 1986: The extension of the</span>
<span class="sd">       Practical Salinity Scale 1978 to low salinities. IEEE J. Oceanic Eng.,</span>
<span class="sd">       11, 109 - 112.</span>

<span class="sd">    .. [3] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp.  Appendix E.</span>

<span class="sd">    .. [4] Unesco, 1983: Algorithms for computation of fundamental properties</span>
<span class="sd">       of seawater.  Unesco Technical Papers in Marine Science, 44, 53 pp.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">C</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="n">t68</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="mf">1.00024</span>
    <span class="n">ft68</span> <span class="o">=</span> <span class="p">(</span><span class="n">t68</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">t68</span> <span class="o">-</span> <span class="mi">15</span><span class="p">))</span>

    <span class="c1"># The dimensionless conductivity ratio, R, is the conductivity input, C,</span>
    <span class="c1"># divided by the present estimate of C(SP=35, t_68=15, p=0) which is</span>
    <span class="c1"># 42.9140 mS/cm (=4.29140 S/m), (Culkin and Smith, 1980).</span>

    <span class="n">R</span> <span class="o">=</span> <span class="mf">0.023302418791070513</span> <span class="o">*</span> <span class="n">C</span>  <span class="c1"># 0.023302418791070513 = 1./42.9140</span>

    <span class="c1"># rt_lc corresponds to rt as defined in the UNESCO 44 (1983) routines.</span>
    <span class="n">rt_lc</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">)</span> <span class="o">*</span> <span class="n">t68</span><span class="p">)</span> <span class="o">*</span> <span class="n">t68</span><span class="p">)</span> <span class="o">*</span> <span class="n">t68</span>
    <span class="n">Rp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span>
         <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">)</span> <span class="o">*</span> <span class="n">R</span><span class="p">))</span>
    <span class="n">Rt</span> <span class="o">=</span> <span class="n">R</span> <span class="o">/</span> <span class="p">(</span><span class="n">Rp</span> <span class="o">*</span> <span class="n">rt_lc</span><span class="p">)</span>

    <span class="n">Rt</span><span class="p">[</span><span class="n">Rt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
    <span class="n">Rtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Rt</span><span class="p">)</span>

    <span class="n">SP</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span>
                  <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span> <span class="o">+</span> <span class="n">ft68</span> <span class="o">*</span>
          <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span>
                   <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">))</span>

    <span class="c1"># The following section of the code is designed for SP &lt; 2 based on the</span>
    <span class="c1"># Hill et al. (1986) algorithm.  This algorithm is adjusted so that it is</span>
    <span class="c1"># exactly equal to the PSS-78 algorithm at SP = 2.</span>

    <span class="n">I2</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">I2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Hill_ratio</span> <span class="o">=</span> <span class="n">Hill_ratio_at_SP2</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">I2</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">*</span> <span class="n">Rt</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>
        <span class="n">sqrty</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>
        <span class="n">part1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">part2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span><span class="p">))</span>
        <span class="n">SP_Hill_raw</span> <span class="o">=</span> <span class="n">SP</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">part1</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ft68</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">/</span> <span class="n">part2</span>
        <span class="n">SP</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Hill_ratio</span> <span class="o">*</span> <span class="n">SP_Hill_raw</span>

    <span class="n">SP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Ensure that SP is non-negative.</span>

    <span class="k">return</span> <span class="n">SP</span></div>


<span class="nd">@match_args_return</span>
<div class="viewcode-block" id="SP_from_R"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.gibbs.practical_salinity.SP_from_R">[docs]</a><span class="k">def</span> <span class="nf">SP_from_R</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Practical Salinity, SP, from the conductivity ratio, R,</span>
<span class="sd">    primarily using the PSS-78 algorithm.  Note that the PSS-78 algorithm for</span>
<span class="sd">    Practical Salinity is only valid in the range 2 &lt; SP &lt; 42.  If the PSS-78</span>
<span class="sd">    algorithm produces a Practical Salinity that is less than 2 then the</span>
<span class="sd">    Practical Salinity is recalculated with a modified form of the Hill et al.</span>
<span class="sd">    (1986) formula.  The modification of the Hill et al. (1986) expression are</span>
<span class="sd">    to ensure that it is exactly consistent with PSS-78 at SP = 2.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : array_like</span>
<span class="sd">        conductivity ratio [unitless]</span>
<span class="sd">    t : array_like</span>
<span class="sd">        in-situ temperature [:math:`^\circ` C (ITS-90)]</span>
<span class="sd">    p : array</span>
<span class="sd">        sea pressure [dbar]</span>
<span class="sd">        (i.e. absolute pressure - 10.1325 dbar)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SP : array</span>
<span class="sd">         Practical Salinity [psu (PSS-78), unitless]</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    TODO</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Culkin and Smith, 1980:  Determination of the Concentration of</span>
<span class="sd">       Potassium Chloride Solution Having the Same Electrical Conductivity, at</span>
<span class="sd">       15C and Infinite Frequency, as Standard Seawater of Salinity 35.0000</span>
<span class="sd">       (Chlorinity 19.37394), IEEE J. Oceanic Eng, 5, 22-23.</span>

<span class="sd">    .. [2] Hill, K.D., T.M. Dauphinee &amp; D.J. Woods, 1986: The extension of the</span>
<span class="sd">       Practical Salinity Scale 1978 to low salinities. IEEE J. Oceanic Eng.,</span>
<span class="sd">       11, 109 - 112.</span>

<span class="sd">    .. [3] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp.  Appendix E.</span>

<span class="sd">    .. [4] Unesco, 1983: Algorithms for computation of fundamental properties</span>
<span class="sd">       of seawater.  Unesco Technical Papers in Marine Science, 44, 53 pp.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="n">t68</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="mf">1.00024</span>
    <span class="n">ft68</span> <span class="o">=</span> <span class="p">(</span><span class="n">t68</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">t68</span> <span class="o">-</span> <span class="mi">15</span><span class="p">))</span>

    <span class="c1"># rt_lc corresponds to rt as defined in the UNESCO 44 (1983) routines.</span>
    <span class="n">rt_lc</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">)</span> <span class="o">*</span> <span class="n">t68</span><span class="p">)</span> <span class="o">*</span> <span class="n">t68</span><span class="p">)</span> <span class="o">*</span> <span class="n">t68</span>
    <span class="n">Rp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span>
         <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">t68</span><span class="p">)</span> <span class="o">*</span> <span class="n">R</span><span class="p">))</span>
    <span class="n">Rt</span> <span class="o">=</span> <span class="n">R</span> <span class="o">/</span> <span class="p">(</span><span class="n">Rp</span> <span class="o">*</span> <span class="n">rt_lc</span><span class="p">)</span>

    <span class="n">Rt</span><span class="p">[</span><span class="n">Rt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
    <span class="n">Rtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Rt</span><span class="p">)</span>

    <span class="n">SP</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span>
                  <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span> <span class="o">+</span> <span class="n">ft68</span> <span class="o">*</span>
          <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span>
                   <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">))</span>

    <span class="c1"># The following section of the code is designed for SP &lt; 2 based on the</span>
    <span class="c1"># Hill et al. (1986) algorithm.  This algorithm is adjusted so that it is</span>
    <span class="c1"># exactly equal to the PSS-78 algorithm at SP = 2.</span>

    <span class="n">I2</span> <span class="o">=</span> <span class="n">SP</span> <span class="o">&lt;</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">I2</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">Hill_ratio</span> <span class="o">=</span> <span class="n">Hill_ratio_at_SP2</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">I2</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">*</span> <span class="n">Rt</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>
        <span class="n">sqrty</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>
        <span class="n">part1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">part2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span><span class="p">))</span>
        <span class="n">SP_Hill_raw</span> <span class="o">=</span> <span class="n">SP</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">part1</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ft68</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">/</span> <span class="n">part2</span>
        <span class="n">SP</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Hill_ratio</span> <span class="o">*</span> <span class="n">SP_Hill_raw</span>

    <span class="n">SP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Ensure that SP is non-negative.</span>

    <span class="k">return</span> <span class="n">SP</span></div>


<span class="nd">@match_args_return</span>
<div class="viewcode-block" id="SP_from_SK"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.gibbs.practical_salinity.SP_from_SK">[docs]</a><span class="k">def</span> <span class="nf">SP_from_SK</span><span class="p">(</span><span class="n">SK</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates Practical Salinity from Knudsen Salinity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SK : array_like</span>
<span class="sd">         Knudsen Salinity [parts per thousand, ppt]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SP : array</span>
<span class="sd">         Practical Salinity [psu (PSS-78), unitless]</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    TODO</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp.  See Appendix A.3.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SP</span> <span class="o">=</span> <span class="p">(</span><span class="n">SK</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.80655</span> <span class="o">/</span> <span class="mf">1.805</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Ensure that SP is non-negative.</span></div>


<span class="nd">@match_args_return</span>
<div class="viewcode-block" id="SP_salinometer"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.gibbs.practical_salinity.SP_salinometer">[docs]</a><span class="k">def</span> <span class="nf">SP_salinometer</span><span class="p">(</span><span class="n">Rt</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Practical Salinity SP from a salinometer, primarily using</span>
<span class="sd">    the PSS-78 algorithm.  Note that the PSS-78 algorithm for Practical</span>
<span class="sd">    Salinity is only valid in the range 2 &lt; SP &lt; 42.  If the PSS-78 algorithm</span>
<span class="sd">    produces a Practical Salinity that is less than 2 then the Practical</span>
<span class="sd">    Salinity is recalculated with a modified form of the Hill et al. (1986)</span>
<span class="sd">    formula. The modification of the Hill et al. (1986) expression is to</span>
<span class="sd">    ensure that it is exactly consistent with PSS-78 at SP = 2.</span>

<span class="sd">    A laboratory salinometer has the ratio of conductivities, Rt, as an output,</span>
<span class="sd">    and the present function uses this conductivity ratio and the temperature t</span>
<span class="sd">    of the salinometer bath as the two input variables.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Rt : array</span>
<span class="sd">         C(SP,t_68,0)/C(SP=35,t_68,0) [unitless]</span>
<span class="sd">         conductivity ratio</span>
<span class="sd">         :math:`R = \frac{C(S, t_68, 0)}{C(35, 15(IPTS-68),0)} [unitless]</span>

<span class="sd">    t : array</span>
<span class="sd">        Temperature of the bath of the salinometer [:math:`^\circ` C (ITS-90)]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SP : array</span>
<span class="sd">         Practical Salinity [psu (PSS-78), unitless]</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    TODO</span>

<span class="sd">    References</span>
<span class="sd">    -----------</span>
<span class="sd">    .. [1] Fofonoff, P. and R.C. Millard Jr. 1983: Algorithms for computation</span>
<span class="sd">       of fundamental properties of seawater.  Unesco Tech. Pap. in Mar. Sci.,</span>
<span class="sd">       44, 53 pp.</span>

<span class="sd">    .. [2] Hill, K.D., T.M. Dauphinee &amp; D.J. Woods, 1986: The extension of the</span>
<span class="sd">       Practical Salinity Scale 1978 to low salinities. IEEE J. Oceanic Eng.,</span>
<span class="sd">       11, 109 - 112.</span>

<span class="sd">    .. [3] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp. See appendix E of this TEOS-10 Manual, and in</span>
<span class="sd">       particular, Eqns. (E.2.1) and (E.2.6).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Rt</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">Rt</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="n">t68</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="mf">1.00024</span>
    <span class="n">ft68</span> <span class="o">=</span> <span class="p">(</span><span class="n">t68</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">t68</span> <span class="o">-</span> <span class="mi">15</span><span class="p">))</span>

    <span class="n">Rt</span><span class="p">[</span><span class="n">Rt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
    <span class="n">Rtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Rt</span><span class="p">)</span>

    <span class="n">SP</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span>
                  <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span> <span class="o">+</span> <span class="n">ft68</span> <span class="o">*</span>
          <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span>
                   <span class="n">Rtx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">))</span>

    <span class="sd">&quot;&quot;&quot;The following section of the code is designed for SP &lt; 2 based on the</span>
<span class="sd">    Hill et al. (1986) algorithm.  This algorithm is adjusted so that it is</span>
<span class="sd">    exactly equal to the PSS-78 algorithm at SP = 2.&quot;&quot;&quot;</span>

    <span class="n">I2</span> <span class="o">=</span> <span class="n">SP</span> <span class="o">&lt;</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">I2</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">Hill_ratio</span> <span class="o">=</span> <span class="n">Hill_ratio_at_SP2</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">I2</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">*</span> <span class="n">Rt</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>
        <span class="n">sqrty</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">Rtx</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span>
        <span class="n">part1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">part2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span><span class="p">))</span>
        <span class="n">SP_Hill_raw</span> <span class="o">=</span> <span class="n">SP</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">part1</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ft68</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">/</span> <span class="n">part2</span>
        <span class="n">SP</span><span class="p">[</span><span class="n">I2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Hill_ratio</span> <span class="o">*</span> <span class="n">SP_Hill_raw</span>
    <span class="c1"># Ensure that SP is non-negative.</span>
    <span class="n">SP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SP</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>