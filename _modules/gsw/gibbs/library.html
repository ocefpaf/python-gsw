<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gsw.gibbs.library &#8212; gsw  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for gsw.gibbs.library</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">.constants</span> <span class="k">import</span> <span class="n">sfac</span><span class="p">,</span> <span class="n">SSO</span><span class="p">,</span> <span class="n">db2Pascal</span>
<span class="kn">from</span> <span class="nn">..utilities</span> <span class="k">import</span> <span class="n">match_args_return</span><span class="p">,</span> <span class="n">strip_mask</span><span class="p">,</span> <span class="n">read_data</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;deltaSA_atlas&#39;</span><span class="p">,</span>
           <span class="s1">&#39;enthalpy_SSO_0&#39;</span><span class="p">,</span>
           <span class="s1">&#39;enthalpy_SSO_0_p&#39;</span><span class="p">,</span>
           <span class="s1">&#39;entropy_part&#39;</span><span class="p">,</span>
           <span class="s1">&#39;entropy_part_zerop&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Fdelta&#39;</span><span class="p">,</span>  <span class="c1"># Seems to be new in V3.</span>
           <span class="s1">&#39;gibbs&#39;</span><span class="p">,</span>
           <span class="s1">&#39;gibbs_pt0_pt0&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Hill_ratio_at_SP2&#39;</span><span class="p">,</span>
           <span class="s1">&#39;infunnel&#39;</span><span class="p">,</span>
           <span class="s1">&#39;interp_ref_cast&#39;</span><span class="p">,</span>
           <span class="s1">&#39;interp_SA_CT&#39;</span><span class="p">,</span>
           <span class="s1">&#39;SAAR&#39;</span><span class="p">,</span>  <span class="c1"># New in V3.</span>
           <span class="s1">&#39;SA_from_SP_Baltic&#39;</span><span class="p">,</span>
           <span class="s1">&#39;specvol_SSO_0_p&#39;</span><span class="p">,</span>
           <span class="s1">&#39;SP_from_SA_Baltic&#39;</span><span class="p">]</span>


<span class="n">h006</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.1078768810e-9</span>
<span class="n">h007</span> <span class="o">=</span>  <span class="mf">2.8019291329e-10</span>


<span class="k">class</span> <span class="nc">SA_table</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO: Write docstring.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Central America barrier</span>
    <span class="n">x_ca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">260.0</span><span class="p">,</span> <span class="mf">272.59</span><span class="p">,</span> <span class="mf">276.5</span><span class="p">,</span> <span class="mf">278.65</span><span class="p">,</span> <span class="mf">280.73</span><span class="p">,</span> <span class="mf">295.217</span><span class="p">])</span>
    <span class="n">y_ca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">19.55</span><span class="p">,</span> <span class="mf">13.97</span><span class="p">,</span> <span class="mf">9.6</span><span class="p">,</span> <span class="mf">8.1</span><span class="p">,</span> <span class="mf">9.33</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s2">&quot;gsw_data_v3_0.npz&quot;</span><span class="p">,</span> <span class="n">max_p_fudge</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                 <span class="n">min_frac</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_p_fudge</span> <span class="o">=</span> <span class="n">max_p_fudge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_frac</span> <span class="o">=</span> <span class="n">min_frac</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">longs_ref</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lats_ref</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">p_ref</span>                <span class="c1"># Depth levels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_ca</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j_ca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_to_ij</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_ca</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ca</span><span class="p">)</span>
        <span class="c1"># Make the order x, y, z:</span>
        <span class="c1"># Start with deltaSA_ref (was delta_SA_ref in V2):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">deltaSA_ref</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsa_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsa_ref</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa_ref</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Now SAAR_ref, which did not exist in V2:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">SAAR_ref</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SAAR_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SAAR_ref</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">SAAR_ref</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">xy_to_ij</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert from lat/lon to grid index coordinates,</span>
<span class="sd">        without truncation or rounding.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlon</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlat</span>
        <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>

    <span class="k">def</span> <span class="nf">_central_america</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">di</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">gm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use a line running through Central America to zero</span>
<span class="sd">        the goodmask for grid points in the Pacific forming</span>
<span class="sd">        the grid box around input locations in the Atlantic,</span>
<span class="sd">        and vice-versa.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ix</span><span class="p">,</span> <span class="n">jy</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">di</span><span class="p">,</span> <span class="n">jj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dj</span>  <span class="c1"># Reconstruction: minor inefficiency.</span>
        <span class="n">inear</span> <span class="o">=</span> <span class="p">((</span><span class="n">ix</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_ca</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ix</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_ca</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                 <span class="o">&amp;</span> <span class="p">(</span><span class="n">jy</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">j_ca</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">jy</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">j_ca</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inear</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">gm</span>
        <span class="n">inear_ind</span> <span class="o">=</span> <span class="n">inear</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="n">ix</span><span class="p">[</span><span class="n">inear</span><span class="p">]</span>
        <span class="n">jy</span> <span class="o">=</span> <span class="n">jy</span><span class="p">[</span><span class="n">inear</span><span class="p">]</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[:,</span> <span class="n">inear</span><span class="p">]</span>
        <span class="n">jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[:,</span> <span class="n">inear</span><span class="p">]</span>
        <span class="n">jy_ca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_ca</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j_ca</span><span class="p">)</span>
        <span class="n">above</span> <span class="o">=</span> <span class="n">jy</span> <span class="o">-</span> <span class="n">jy_ca</span>  <span class="c1"># &gt; 0 if input point is above dividing line</span>
        <span class="c1"># Intersections of left and right grid lines with dividing line</span>
        <span class="n">jleft_ca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ii</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_ca</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j_ca</span><span class="p">)</span>
        <span class="n">jright_ca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ii</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_ca</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j_ca</span><span class="p">)</span>
        <span class="n">jgrid_ca</span> <span class="o">=</span> <span class="p">[</span><span class="n">jleft_ca</span><span class="p">,</span> <span class="n">jright_ca</span><span class="p">,</span> <span class="n">jright_ca</span><span class="p">,</span> <span class="n">jleft_ca</span><span class="p">]</span>
        <span class="c1"># Zero the goodmask for grid points on opposite side of divider</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">opposite</span> <span class="o">=</span> <span class="p">(</span><span class="n">above</span> <span class="o">*</span> <span class="p">(</span><span class="n">jj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">jgrid_ca</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="mi">0</span>
            <span class="n">gm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">inear_ind</span><span class="p">[</span><span class="n">opposite</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">gm</span>

    <span class="k">def</span> <span class="nf">xy_interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">di</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        2-D interpolation, bilinear if all 4 surrounding</span>
<span class="sd">        grid points are present, but treating missing points</span>
<span class="sd">        as having the average value of the remaining grid</span>
<span class="sd">        points. This matches the matlab V2 behavior.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Array of weights, CCW around the grid box</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">di</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">dj</span><span class="p">),</span>  <span class="c1"># lower left</span>
                      <span class="n">di</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">dj</span><span class="p">),</span>         <span class="c1"># lower right</span>
                      <span class="n">di</span> <span class="o">*</span> <span class="n">dj</span><span class="p">,</span>               <span class="c1"># upper right</span>
                      <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">di</span><span class="p">)</span> <span class="o">*</span> <span class="n">dj</span><span class="p">))</span>        <span class="c1"># upper left</span>
        <span class="n">gm</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">dsa</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>   <span class="c1"># gm is &quot;goodmask&quot;</span>
        <span class="n">gm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_america</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">gm</span><span class="p">)</span>
        <span class="c1"># Save a measure of real interpolation quality.</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">gm</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Now loosen the interpolation, allowing a value to</span>
        <span class="c1"># be calculated on a grid point that is masked.</span>
        <span class="c1"># This matches the matlab gsw version 2 behavior.</span>
        <span class="n">jm_partial</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
        <span class="c1"># The weights of the unmasked points will be increased</span>
        <span class="c1"># by the sum of the weights of the masked points divided</span>
        <span class="c1"># by the number of unmasked points in the grid square.</span>
        <span class="c1"># This is equivalent to setting the masked data values</span>
        <span class="c1"># to the average of the unmasked values, and then</span>
        <span class="c1"># unmasking, which is the matlab v2 implementation.</span>
        <span class="k">if</span> <span class="n">jm_partial</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">w_bad</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="o">~</span><span class="n">gm</span><span class="p">)</span>
            <span class="n">w</span><span class="p">[:,</span> <span class="n">jm_partial</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">w_bad</span><span class="p">[:,</span> <span class="n">jm_partial</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span>
                                 <span class="n">gm</span><span class="p">[:,</span> <span class="n">jm_partial</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">w</span> <span class="o">*=</span> <span class="n">gm</span>
        <span class="n">wsum</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">wsum</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># Only need to prevent division by zero here.</span>
        <span class="n">w</span><span class="p">[:,</span> <span class="n">valid</span><span class="p">]</span> <span class="o">/=</span> <span class="n">wsum</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>
        <span class="n">w</span><span class="p">[:,</span> <span class="o">~</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">vv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
        <span class="n">vv</span> <span class="o">*=</span> <span class="n">w</span>
        <span class="n">dsa</span> <span class="o">=</span> <span class="n">vv</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dsa</span><span class="p">,</span> <span class="n">frac</span>

    <span class="k">def</span> <span class="nf">_delta_SA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Table lookup engine--to be called only from SAAR or SA_ref.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mask_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">mask_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">lon</span><span class="p">))</span>
        <span class="n">mask_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">mask_or</span><span class="p">(</span><span class="n">mask_in</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)]</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shape_in</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)))</span>
            <span class="n">reshaped</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reshaped</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">p_orig</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Save for comparison to clipped p.</span>
        <span class="n">ix0</span><span class="p">,</span> <span class="n">iy0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_to_ij</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
        <span class="n">i0raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ix0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">i0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">i0raw</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">di</span> <span class="o">=</span> <span class="n">ix0</span> <span class="o">-</span> <span class="n">i0</span>
        <span class="n">j0raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">iy0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">j0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">j0raw</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">dj</span> <span class="o">=</span> <span class="n">iy0</span> <span class="o">-</span> <span class="n">j0</span>
        <span class="c1"># Start at lower left and go CCW; match order in _xy_interp.</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">i0</span><span class="p">,</span> <span class="n">i0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i0</span><span class="p">))</span>
        <span class="n">jj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">j0</span><span class="p">,</span> <span class="n">j0</span><span class="p">,</span> <span class="n">j0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="c1"># Clip p and k1 at max p of grid cell.</span>
        <span class="n">kmax</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndepth</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">mask_out</span> <span class="o">=</span> <span class="n">kmax</span><span class="o">.</span><span class="n">mask</span>
        <span class="n">kmax</span> <span class="o">=</span> <span class="n">kmax</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">clip_p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">kmax</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="n">clip_p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">kmax</span><span class="p">[</span><span class="n">clip_p</span><span class="p">]]</span>
        <span class="n">k1</span><span class="p">[</span><span class="n">clip_p</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmax</span><span class="p">[</span><span class="n">clip_p</span><span class="p">]</span>
        <span class="n">k0</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">dsa0</span><span class="p">,</span> <span class="n">frac0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_interp</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">k0</span><span class="p">)</span>
        <span class="n">dsa1</span><span class="p">,</span> <span class="n">frac1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_interp</span><span class="p">(</span><span class="n">di</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">k1</span><span class="p">)</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pfrac</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">k0</span><span class="p">])</span> <span class="o">/</span> <span class="n">dp</span><span class="p">[</span><span class="n">k0</span><span class="p">]</span>
        <span class="n">delta_SA</span> <span class="o">=</span> <span class="n">dsa0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pfrac</span><span class="p">)</span> <span class="o">+</span> <span class="n">dsa1</span> <span class="o">*</span> <span class="n">pfrac</span>
        <span class="c1"># Save intermediate results in case we are curious about</span>
        <span class="c1"># them; the frac values are most likely to be useful.</span>
        <span class="c1"># We won&#39;t bother to reshape them, though, and we may</span>
        <span class="c1"># delete them later.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsa0</span> <span class="o">=</span> <span class="n">dsa0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frac0</span> <span class="o">=</span> <span class="n">frac0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsa1</span> <span class="o">=</span> <span class="n">dsa1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frac1</span> <span class="o">=</span> <span class="n">frac1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pfrac</span> <span class="o">=</span> <span class="n">pfrac</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_fudge</span> <span class="o">=</span> <span class="n">p_orig</span> <span class="o">-</span> <span class="n">p</span>
        <span class="c1"># Editing options, in case we don&#39;t want to use</span>
        <span class="c1"># values calculated from the wrong pressure, or from</span>
        <span class="c1"># an incomplete SA table grid square.</span>
        <span class="c1"># mask_out |= self.p_fudge &gt; self.max_p_fudge</span>
        <span class="c1"># mask_out |= self.frac1 &lt; self.min_frac</span>
        <span class="c1"># delta_SA = np.ma.array(delta_SA, mask=mask_out, copy=False)</span>
        <span class="c1"># Later on, it is expected to be a masked array.</span>
        <span class="n">delta_SA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delta_SA</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reshaped</span><span class="p">:</span>
            <span class="n">delta_SA</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape_in</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_fudge</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape_in</span>
        <span class="k">if</span> <span class="n">mask_in</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">nomask</span><span class="p">:</span>
            <span class="n">delta_SA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delta_SA</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask_in</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delta_SA</span>

    <span class="k">def</span> <span class="nf">SAAR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Table lookup of salinity anomaly ratio, given pressure, lon, and lat.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SAAR_ref</span>
        <span class="c1"># In V2,</span>
        <span class="c1"># ndepth from the file disagrees with the unmasked count from</span>
        <span class="c1"># SAAR_ref in a few places; this should be fixed in the</span>
        <span class="c1"># file, but for now we will simply calculate ndepth directly from</span>
        <span class="c1"># SAAR_ref.</span>
        <span class="c1"># TODO: check to see whether this discrepancy is also found in V3.</span>
        <span class="c1"># TODO: check: do we even need to calculate ndepth? It doesn&#39;t</span>
        <span class="c1">#       appear to be used for anything.</span>
        <span class="c1"># self.ndepth = np.ma.masked_invalid(data.ndepth_ref.T).astype(np.int8)</span>
        <span class="n">ndepth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsa</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndepth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">ndepth</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_SA</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delta_SA_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Table lookup of salinity anomaly reference value, given pressure,</span>
<span class="sd">        lon, and lat.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsa_ref</span>
        <span class="c1"># See comment in previous method.</span>
        <span class="n">ndepth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsa</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndepth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="n">ndepth</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_SA</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>


<div class="viewcode-block" id="Fdelta"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.Fdelta">[docs]</a><span class="k">def</span> <span class="nf">Fdelta</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fdelta from the Absolute Salinity Anomaly Ratio (SAAR):</span>
<span class="sd">    Fdelta = (1 + r1)SAAR/(1 - r1*SAAR)</span>
<span class="sd">           = (SA/Sstar) - 1</span>
<span class="sd">    with r1 being the constant 0.35 based on the work of Pawlowicz et al.</span>
<span class="sd">    (2011). Note that since SAAR is everywhere less than 0.001 in the global</span>
<span class="sd">    ocean, Fdelta is only slightly different to 1.35*SAAR.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : array_like</span>
<span class="sd">        pressure [dbar]</span>
<span class="sd">    lon : array_like</span>
<span class="sd">          decimal degrees east (will be treated modulo 360)</span>
<span class="sd">    lat : array_like</span>
<span class="sd">          decimal degrees (+ve N, -ve S) [-90..+90]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Fdelta : masked array; masked where no nearby ocean is found in data</span>
<span class="sd">           Ratio of SA to Sstar, minus 1 [unitless]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The mask is only set when the observation is well and truly on dry</span>
<span class="sd">    land; often the warning flag is not set until one is several hundred</span>
<span class="sd">    kilometers inland from the coast.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp.  Available from http://www.TEOS-10.org</span>
<span class="sd">       See section 2.5 and appendices A.4 and A.5 of this TEOS-10 Manual.</span>

<span class="sd">    .. [2] McDougall, T.J., D.R. Jackett, F.J. Millero, R. Pawlowicz and</span>
<span class="sd">       P.M. Barker, 2012: A global algorithm for estimating Absolute Salinity.</span>
<span class="sd">       Ocean Science, 8, 1123-1134.</span>
<span class="sd">       http://www.ocean-sci.net/8/1123/2012/os-8-1123-2012.pdf</span>

<span class="sd">    .. [3] Pawlowicz, R., D.G. Wright and F.J. Millero, 2011; The effects of</span>
<span class="sd">       biogeochemical processes on oceanic conductivity/salinty/density</span>
<span class="sd">       relationships and the characterization of real seawater. Ocean Science,</span>
<span class="sd">       7, 363-387.  http://www.ocean-sci.net/7/363/2011/os-7-363-2011.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">r</span> <span class="o">=</span> <span class="mf">0.35</span>
    <span class="n">saar</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">SAAR</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
    <span class="n">Fdelta</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">saar</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span> <span class="o">*</span> <span class="n">saar</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Fdelta</span></div>


<span class="nd">@match_args_return</span>
<div class="viewcode-block" id="Hill_ratio_at_SP2"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.Hill_ratio_at_SP2">[docs]</a><span class="k">def</span> <span class="nf">Hill_ratio_at_SP2</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    USAGE:</span>
<span class="sd">     Hill_ratio = Hill_ratio_at_SP2(t)</span>

<span class="sd">    DESCRIPTION:</span>
<span class="sd">     Calculates the Hill ratio, which is the adjustment needed to apply for</span>
<span class="sd">     Practical Salinities smaller than 2.  This ratio is defined at a</span>
<span class="sd">     Practical Salinity = 2 and in-situ temperature, t using PSS-78. The Hill</span>
<span class="sd">     ratio is the ratio of 2 to the output of the Hill et al. (1986) formula</span>
<span class="sd">     for Practical Salinity at the conductivity ratio, Rt, at which Practical</span>
<span class="sd">     Salinity on the PSS-78 scale is exactly 2.</span>

<span class="sd">    INPUT:</span>
<span class="sd">     t  =  in-situ temperature (ITS-90)                  [ deg C ]</span>

<span class="sd">    OUTPUT:</span>
<span class="sd">     Hill_ratio  =  Hill ratio at SP of 2                [ unitless ]</span>

<span class="sd">    AUTHOR:</span>
<span class="sd">     Trevor McDougall and Paul Barker</span>

<span class="sd">    VERSION NUMBER: 3.0 (26th March, 2011)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SP2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="n">a0</span> <span class="o">=</span> <span class="mf">0.0080</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1692</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="mf">25.3851</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="mf">14.0941</span>
    <span class="n">a4</span> <span class="o">=</span> <span class="o">-</span><span class="mf">7.0261</span>
    <span class="n">a5</span> <span class="o">=</span> <span class="mf">2.7081</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="mf">0.0005</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0056</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0066</span>
    <span class="n">b3</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0375</span>
    <span class="n">b4</span> <span class="o">=</span> <span class="mf">0.0636</span>
    <span class="n">b5</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0144</span>
    <span class="n">g0</span> <span class="o">=</span> <span class="mf">2.641463563366498e-1</span>
    <span class="n">g1</span> <span class="o">=</span> <span class="mf">2.007883247811176e-4</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4.107694432853053e-6</span>
    <span class="n">g3</span> <span class="o">=</span> <span class="mf">8.401670882091225e-8</span>
    <span class="n">g4</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.711392021989210e-9</span>
    <span class="n">g5</span> <span class="o">=</span> <span class="mf">3.374193893377380e-11</span>
    <span class="n">g6</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.923731174730784e-13</span>
    <span class="n">g7</span> <span class="o">=</span> <span class="mf">8.057771569962299e-15</span>
    <span class="n">g8</span> <span class="o">=</span> <span class="o">-</span><span class="mf">7.054313817447962e-17</span>
    <span class="n">g9</span> <span class="o">=</span> <span class="mf">2.859992717347235e-19</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mf">0.0162</span>
    <span class="n">t68</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="mf">1.00024</span>
    <span class="n">ft68</span> <span class="o">=</span> <span class="p">(</span><span class="n">t68</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">t68</span> <span class="o">-</span> <span class="mi">15</span><span class="p">))</span>
    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Find the initial estimates of Rtx (Rtx0) and of the derivative dSP_dRtx</span>
    <span class="c1"># at SP = 2.</span>
    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="n">Rtx0</span> <span class="o">=</span> <span class="n">g0</span> <span class="o">+</span> <span class="n">t68</span> <span class="o">*</span> <span class="p">(</span><span class="n">g1</span> <span class="o">+</span> <span class="n">t68</span> <span class="o">*</span> <span class="p">(</span><span class="n">g2</span> <span class="o">+</span> <span class="n">t68</span> <span class="o">*</span> <span class="p">(</span><span class="n">g3</span> <span class="o">+</span> <span class="n">t68</span> <span class="o">*</span> <span class="p">(</span><span class="n">g4</span> <span class="o">+</span> <span class="n">t68</span> <span class="o">*</span> <span class="p">(</span><span class="n">g5</span>
              <span class="o">+</span> <span class="n">t68</span> <span class="o">*</span> <span class="p">(</span><span class="n">g6</span> <span class="o">+</span> <span class="n">t68</span> <span class="o">*</span> <span class="p">(</span><span class="n">g7</span> <span class="o">+</span> <span class="n">t68</span> <span class="o">*</span> <span class="p">(</span><span class="n">g8</span> <span class="o">+</span> <span class="n">t68</span> <span class="o">*</span> <span class="n">g9</span><span class="p">))))))))</span>
    <span class="n">dSP_dRtx</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">a5</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span>
                <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx0</span> <span class="o">+</span> <span class="n">ft68</span> <span class="o">*</span> <span class="p">(</span><span class="n">b1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">b3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">b4</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span>
                <span class="n">b5</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">))</span>
    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Begin a single modified Newton-Raphson iteration to find Rt at SP = 2.</span>
    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="n">SP_est</span> <span class="o">=</span> <span class="p">(</span><span class="n">a0</span> <span class="o">+</span> <span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="p">(</span><span class="n">a2</span> <span class="o">+</span> <span class="p">(</span><span class="n">a3</span> <span class="o">+</span> <span class="p">(</span><span class="n">a4</span> <span class="o">+</span> <span class="n">a5</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span>
              <span class="n">Rtx0</span> <span class="o">+</span> <span class="n">ft68</span> <span class="o">*</span> <span class="p">(</span><span class="n">b0</span> <span class="o">+</span> <span class="p">(</span><span class="n">b1</span> <span class="o">+</span> <span class="p">(</span><span class="n">b2</span> <span class="o">+</span> <span class="p">(</span><span class="n">b3</span> <span class="o">+</span> <span class="p">(</span><span class="n">b4</span> <span class="o">+</span> <span class="n">b5</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span>
              <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtx0</span><span class="p">))</span>
    <span class="n">Rtx</span> <span class="o">=</span> <span class="n">Rtx0</span> <span class="o">-</span> <span class="p">(</span><span class="n">SP_est</span> <span class="o">-</span> <span class="n">SP2</span><span class="p">)</span> <span class="o">/</span> <span class="n">dSP_dRtx</span>
    <span class="n">Rtxm</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rtx</span> <span class="o">+</span> <span class="n">Rtx0</span><span class="p">)</span>
    <span class="n">dSP_dRtx</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">a4</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">a5</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span>
                <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtxm</span> <span class="o">+</span> <span class="n">ft68</span> <span class="o">*</span> <span class="p">(</span><span class="n">b1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">b3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">b4</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span>
                <span class="n">b5</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rtxm</span><span class="p">))</span>
    <span class="n">Rtx</span> <span class="o">=</span> <span class="n">Rtx0</span> <span class="o">-</span> <span class="p">(</span><span class="n">SP_est</span> <span class="o">-</span> <span class="n">SP2</span><span class="p">)</span> <span class="o">/</span> <span class="n">dSP_dRtx</span>
    <span class="c1"># This is the end of one full iteration of the modified Newton-Raphson</span>
    <span class="c1"># iterative equation solver.  The error in Rtx at this point is equivalent</span>
    <span class="c1"># to an error in SP of 9e-16 psu.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">*</span> <span class="n">Rtx</span> <span class="o">*</span> <span class="n">Rtx</span>
    <span class="n">sqrty</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">Rtx</span>
    <span class="n">part1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">part2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrty</span><span class="p">))</span>
    <span class="n">SP_Hill_raw_at_SP2</span> <span class="o">=</span> <span class="n">SP2</span> <span class="o">-</span> <span class="n">a0</span> <span class="o">/</span> <span class="n">part1</span> <span class="o">-</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">ft68</span> <span class="o">/</span> <span class="n">part2</span>
    <span class="k">return</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">SP_Hill_raw_at_SP2</span></div>


<span class="nd">@match_args_return</span>
<div class="viewcode-block" id="SAAR"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.SAAR">[docs]</a><span class="k">def</span> <span class="nf">SAAR</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Absolute Salinity Anomaly Ratio (excluding the Baltic Sea).</span>
<span class="sd">    Calculates the Absolute Salinity Anomaly Ratio, SAAR, in the open ocean</span>
<span class="sd">    by spatially interpolating the global reference data set of SAAR to the</span>
<span class="sd">    location of the seawater sample.</span>
<span class="sd">    This function uses version 3.0 of the SAAR look up table.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : array_like</span>
<span class="sd">        pressure [dbar]</span>
<span class="sd">    lon : array_like</span>
<span class="sd">          decimal degrees east (will be treated modulo 360)</span>
<span class="sd">    lat : array_like</span>
<span class="sd">          decimal degrees (+ve N, -ve S) [-90..+90]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SAAR : array</span>
<span class="sd">           Absolute Salinity Anomaly Ratio [unitless]</span>
<span class="sd">    in_ocean : boolean array</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The Absolute Salinity Anomaly Ratio in the Baltic Sea is evaluated</span>
<span class="sd">    separately, since it is a function of Practical Salinity, not of space.</span>
<span class="sd">    The present function returns a SAAR of zero for data in the Baltic Sea.</span>
<span class="sd">    The correct way of calculating Absolute Salinity in the Baltic Sea is by</span>
<span class="sd">    calling SA_from_SP.</span>
<span class="sd">    The in_ocean flag is only set when the observation is well and truly on dry</span>
<span class="sd">    land; often the warning flag is not set until one is several hundred</span>
<span class="sd">    kilometers inland from the coast.</span>

<span class="sd">    The algorithm is taken from the matlab implementation of the references,</span>
<span class="sd">    but the numpy implementation here differs substantially from the</span>
<span class="sd">    matlab implementation.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp.</span>

<span class="sd">    .. [2] McDougall, T.J., D.R. Jackett and F.J. Millero, 2010: An algorithm</span>
<span class="sd">       for estimating Absolute Salinity in the global ocean.  Submitted to</span>
<span class="sd">       Ocean Science. A preliminary version is available at Ocean Sci.</span>
<span class="sd">       Discuss., 6, 215-242.</span>
<span class="sd">       http://www.ocean-sci-discuss.net/6/215/2009/osd-6-215-2009-print.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">saar</span> <span class="o">=</span> <span class="n">SA_table</span><span class="p">()</span><span class="o">.</span><span class="n">SAAR</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">saar</span><span class="p">,</span> <span class="o">~</span><span class="n">saar</span><span class="o">.</span><span class="n">mask</span></div>


<div class="viewcode-block" id="SA_from_SP_Baltic"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.SA_from_SP_Baltic">[docs]</a><span class="k">def</span> <span class="nf">SA_from_SP_Baltic</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes absolute salinity from practical in the Baltic Sea.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SP : array_like or masked array</span>
<span class="sd">        Practical salinity (PSS-78)</span>
<span class="sd">    lon, lat : array_like or masked arrays</span>
<span class="sd">               geographical position</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SA : masked array, at least 1D</span>
<span class="sd">         Absolute salinity   [g/kg]</span>
<span class="sd">         masked where inputs are masked or position outside the Baltic</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Handle masked array input</span>
    <span class="n">input_mask</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">SP</span><span class="p">):</span>
        <span class="n">input_mask</span> <span class="o">=</span> <span class="n">input_mask</span> <span class="o">|</span> <span class="n">SP</span><span class="o">.</span><span class="n">mask</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">lon</span><span class="p">):</span>
        <span class="n">input_mask</span> <span class="o">=</span> <span class="n">input_mask</span> <span class="o">|</span> <span class="n">lon</span><span class="o">.</span><span class="n">mask</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">lat</span><span class="p">):</span>
        <span class="n">input_mask</span> <span class="o">=</span> <span class="n">input_mask</span> <span class="o">|</span> <span class="n">lat</span><span class="o">.</span><span class="n">mask</span>
    <span class="n">SP</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">,</span> <span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)))</span>
    <span class="n">SP</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
    <span class="n">inds_baltic</span> <span class="o">=</span> <span class="n">in_Baltic</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
    <span class="c1"># SA_baltic = np.ma.masked_all(SP.shape, dtype=np.float)</span>
    <span class="n">all_nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
    <span class="n">SA_baltic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">all_nans</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">inds_baltic</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">inds_baltic</span><span class="p">):</span>
        <span class="n">SA_baltic</span><span class="p">[</span><span class="n">inds_baltic</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">SSO</span> <span class="o">-</span> <span class="mf">0.087</span><span class="p">)</span> <span class="o">/</span> <span class="mi">35</span><span class="p">)</span> <span class="o">*</span>
                                  <span class="n">SP</span><span class="p">[</span><span class="n">inds_baltic</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.087</span><span class="p">)</span>
    <span class="n">SA_baltic</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">SA_baltic</span><span class="o">.</span><span class="n">mask</span> <span class="o">|</span> <span class="n">input_mask</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SA_baltic</span></div>


<div class="viewcode-block" id="SP_from_SA_Baltic"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.SP_from_SA_Baltic">[docs]</a><span class="k">def</span> <span class="nf">SP_from_SA_Baltic</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Practical Salinity (SP) for the Baltic Sea, from a value</span>
<span class="sd">    computed analytically from Absolute Salinity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SA : array_like</span>
<span class="sd">         Absolute salinity [g kg :sup:`-1`]</span>
<span class="sd">    lon : array_like</span>
<span class="sd">          decimal degrees east [0..+360]</span>
<span class="sd">    lat : array_like</span>
<span class="sd">          decimal degrees (+ve N, -ve S) [-90..+90]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SP_baltic : array_like</span>
<span class="sd">                salinity [psu (PSS-78)], unitless</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    SP_from_SA, SP_from_Sstar</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This program will only produce Practical Salinity values for the Baltic</span>
<span class="sd">    Sea.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    TODO</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Feistel, R., S. Weinreben, H. Wolf, S. Seitz, P. Spitzer, B. Adel,</span>
<span class="sd">       G. Nausch, B. Schneider and D. G. Wright, 2010c: Density and Absolute</span>
<span class="sd">       Salinity of the Baltic Sea 2006-2009.  Ocean Science, 6, 3-24.</span>
<span class="sd">       http://www.ocean-sci.net/6/3/2010/os-6-3-2010.pdf</span>

<span class="sd">    .. [2] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp.</span>

<span class="sd">    .. [3] McDougall, T.J., D.R. Jackett and F.J. Millero, 2010: An algorithm</span>
<span class="sd">       for estimating Absolute Salinity in the global ocean. Submitted to Ocean</span>
<span class="sd">       Science. A preliminary version is available at Ocean Sci. Discuss.,</span>
<span class="sd">       6, 215-242.</span>
<span class="sd">       http://www.ocean-sci-discuss.net/6/215/2009/osd-6-215-2009-print.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SA</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">,</span> <span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)))</span>
    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">SA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">SA</span><span class="p">)</span>
    <span class="n">inds_baltic</span> <span class="o">=</span> <span class="n">in_Baltic</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inds_baltic</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">SP_baltic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_all</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">SP_baltic</span><span class="p">[</span><span class="n">inds_baltic</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">35</span> <span class="o">/</span> <span class="p">(</span><span class="n">SSO</span> <span class="o">-</span> <span class="mf">0.087</span><span class="p">))</span> <span class="o">*</span>
                              <span class="p">(</span><span class="n">SA</span><span class="p">[</span><span class="n">inds_baltic</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.087</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">SP_baltic</span></div>


<span class="c1"># FIXME: Check if this is still used and remove it.</span>
<span class="k">def</span> <span class="nf">SP_from_SA_Baltic_old</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Practical Salinity (SP) for the Baltic Sea, from a value</span>
<span class="sd">    computed analytically from Absolute Salinity.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SA : array_like</span>
<span class="sd">         Absolute salinity [g kg :sup:`-1`]</span>
<span class="sd">    lon : array_like</span>
<span class="sd">          decimal degrees east [0..+360]</span>
<span class="sd">    lat : array_like</span>
<span class="sd">          decimal degrees (+ve N, -ve S) [-90..+90]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SP_baltic : array_like</span>
<span class="sd">                salinity [psu (PSS-78)], unitless</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    SP_from_SA, SP_from_Sstar</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This program will only produce Practical Salinity values for the Baltic</span>
<span class="sd">    Sea.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    TODO</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Feistel, R., S. Weinreben, H. Wolf, S. Seitz, P. Spitzer, B. Adel,</span>
<span class="sd">       G. Nausch, B. Schneider and D. G. Wright, 2010c: Density and Absolute</span>
<span class="sd">       Salinity of the Baltic Sea 2006-2009.  Ocean Science, 6, 3-24.</span>
<span class="sd">       http://www.ocean-sci.net/6/3/2010/os-6-3-2010.pdf</span>

<span class="sd">    .. [2] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp.</span>

<span class="sd">    .. [3] McDougall, T.J., D.R. Jackett and F.J. Millero, 2010: An algorithm</span>
<span class="sd">       for estimating Absolute Salinity in the global ocean. Submitted to Ocean</span>
<span class="sd">       Science. A preliminary version is available at Ocean Sci. Discuss.,</span>
<span class="sd">       6, 215-242.</span>
<span class="sd">       http://www.ocean-sci-discuss.net/6/215/2009/osd-6-215-2009-print.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SA</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">,</span> <span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)))</span>
    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">SA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">SA</span><span class="p">,</span> <span class="n">subok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">xb1</span><span class="p">,</span> <span class="n">xb2</span><span class="p">,</span> <span class="n">xb3</span> <span class="o">=</span> <span class="mf">12.6</span><span class="p">,</span> <span class="mf">7.</span><span class="p">,</span> <span class="mf">26.</span>
    <span class="n">xb1a</span><span class="p">,</span> <span class="n">xb3a</span> <span class="o">=</span> <span class="mf">45.</span><span class="p">,</span> <span class="mf">26.</span>
    <span class="n">yb1</span><span class="p">,</span> <span class="n">yb2</span><span class="p">,</span> <span class="n">yb3</span> <span class="o">=</span> <span class="mf">50.</span><span class="p">,</span> <span class="mf">59.</span><span class="p">,</span> <span class="mf">69.</span>
    <span class="n">inds_baltic</span> <span class="o">=</span> <span class="p">(</span><span class="n">xb2</span> <span class="o">&lt;</span> <span class="n">lon</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&lt;</span> <span class="n">xb1a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">yb1</span> <span class="o">&lt;</span> <span class="n">lat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">yb3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inds_baltic</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">SP_baltic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_all</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">xx_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lat</span><span class="p">[</span><span class="n">inds_baltic</span><span class="p">],</span> <span class="p">[</span><span class="n">yb1</span><span class="p">,</span> <span class="n">yb2</span><span class="p">,</span> <span class="n">yb3</span><span class="p">],</span> <span class="p">[</span><span class="n">xb1</span><span class="p">,</span> <span class="n">xb2</span><span class="p">,</span> <span class="n">xb3</span><span class="p">])</span>
    <span class="n">xx_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lat</span><span class="p">[</span><span class="n">inds_baltic</span><span class="p">],</span> <span class="p">[</span><span class="n">yb1</span><span class="p">,</span> <span class="n">yb3</span><span class="p">],</span> <span class="p">[</span><span class="n">xb1a</span><span class="p">,</span> <span class="n">xb3a</span><span class="p">])</span>
    <span class="n">inds_baltic1</span> <span class="o">=</span> <span class="p">((</span><span class="n">xx_left</span> <span class="o">&lt;=</span> <span class="n">lon</span><span class="p">[</span><span class="n">inds_baltic</span><span class="p">])</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">lon</span><span class="p">[</span><span class="n">inds_baltic</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">xx_right</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inds_baltic1</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">SP_baltic</span><span class="p">[</span><span class="n">inds_baltic</span><span class="p">[</span><span class="n">inds_baltic1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">35</span> <span class="o">/</span> <span class="p">(</span><span class="n">SSO</span> <span class="o">-</span> <span class="mf">0.087</span><span class="p">))</span> <span class="o">*</span>
                                            <span class="p">(</span><span class="n">SA</span><span class="p">[</span><span class="n">inds_baltic</span><span class="p">[</span><span class="n">inds_baltic1</span><span class="p">]]</span> <span class="o">-</span>
                                             <span class="mf">0.087</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">SP_baltic</span>


<span class="nd">@match_args_return</span>
<div class="viewcode-block" id="deltaSA_atlas"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.deltaSA_atlas">[docs]</a><span class="k">def</span> <span class="nf">deltaSA_atlas</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Absolute Salinity anomaly atlas value (excluding the Baltic Sea).</span>
<span class="sd">    Calculates the Absolute Salinity anomaly atlas value, SA - SR,</span>
<span class="sd">    in the open ocean by spatially interpolating the global reference</span>
<span class="sd">    data set of deltaSA_atlas to the location of the seawater sample.</span>
<span class="sd">    This function uses version 3.0 of the deltaSA_ref look up table.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : array_like</span>
<span class="sd">        sea pressure (absolute pressure - 10.1325 dbar) [dbar]</span>
<span class="sd">    lon : array_like</span>
<span class="sd">          decimal degrees east (will be treated modulo 360)</span>
<span class="sd">    lat : array_like</span>
<span class="sd">          decimal degrees (+ve N, -ve S) [-90..+90]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    deltaSA_atlas : masked array; masked where no nearby ocean is found in data</span>
<span class="sd">           Absolute Salinity anomaly atlas value  [g/kg]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The Absolute Salinity anomaly atlas value in the Baltic Sea is</span>
<span class="sd">    evaluated separately, since it is a function of Practical Salinity,</span>
<span class="sd">    not of space. The present function returns a deltaSA_atlas of zero</span>
<span class="sd">    for data in the Baltic Sea. The correct way of calculating Absolute</span>
<span class="sd">    Salinity in the Baltic Sea is by calling SA_from_SP.</span>
<span class="sd">    The mask is only set when the observation is well and truly on dry</span>
<span class="sd">    land; often the warning flag is not set until one is several hundred</span>
<span class="sd">    kilometers inland from the coast.</span>

<span class="sd">    The algorithm is taken from the Matlab implementation of the references,</span>
<span class="sd">    but the numpy implementation here differs substantially from the</span>
<span class="sd">    Matlab implementation.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp.</span>

<span class="sd">    .. [2] McDougall, T.J., D.R. Jackett and F.J. Millero, 2010: An algorithm</span>
<span class="sd">       for estimating Absolute Salinity in the global ocean.  Submitted to Ocean</span>
<span class="sd">       Science. A preliminary version is available at Ocean Sci. Discuss.,</span>
<span class="sd">       6, 215-242.</span>
<span class="sd">       http://www.ocean-sci-discuss.net/6/215/2009/osd-6-215-2009-print.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SA_table</span><span class="p">()</span><span class="o">.</span><span class="n">delta_SA_ref</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">enthalpy_SSO_0_CT25</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates enthalpy at the Standard Ocean Salinity (SSO) and at a</span>
<span class="sd">    Conservative Temperature of zero degrees C (CT=0), as a function of</span>
<span class="sd">    pressure (p [dbar]) or enthalpy_CT25(35.16504,0,p).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : array_like</span>
<span class="sd">        pressure [dbar]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    enthalpy_CT25 : array_like</span>
<span class="sd">                    enthalpy_CT25 at (SSO, CT = 0, p), 25-term equation.</span>
<span class="sd">                    [J kg :sup:`-1`]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Uses a streamlined version of the 25-term CT version of the Gibbs function,</span>
<span class="sd">    that is, a streamlined version of the code &quot;enthalpy_CT25(SA,CT,p)&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0777716085618458e-3</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SSO</span><span class="p">)</span> <span class="o">*</span>
                    <span class="mf">3.4688210757917340e-6</span><span class="p">)</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="mf">6.8314629554123324e-6</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="mf">9.9984380290708214e2</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.8925731541277653e0</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span>
                                       <span class="mf">1.9457531751183059e-3</span><span class="p">)</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.1930681818531748e-2</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span> <span class="mf">5.9355685925035653e-6</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5943389807429039e-8</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b1</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">b2</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b1</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">b2</span><span class="p">)</span>
    <span class="n">part</span> <span class="o">=</span> <span class="p">(</span><span class="n">a0</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">b1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b2</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span>
    <span class="n">enthalpy_SSO_0_CT25</span> <span class="o">=</span> <span class="p">(</span><span class="n">db2Pascal</span> <span class="o">*</span> <span class="p">((</span><span class="n">a1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b2</span><span class="p">))</span> <span class="o">*</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">part</span> <span class="o">*</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">b2</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span> <span class="o">/</span>
                           <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">p</span><span class="p">)))))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">enthalpy_SSO_0_CT25</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<div class="viewcode-block" id="enthalpy_SSO_0"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.enthalpy_SSO_0">[docs]</a><span class="k">def</span> <span class="nf">enthalpy_SSO_0</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enthalpy at SSO and CT(T=0) (75-term equation)</span>

<span class="sd">    This function calculates enthalpy at the Standard Ocean Salinty, SSO,</span>
<span class="sd">    and at a Conservative Temperature of zero degrees C, as a function of</span>
<span class="sd">    pressure, p, in dbar, using a streamlined version of the 75-term</span>
<span class="sd">    computationally-efficient expression for specific volume, that is, a</span>
<span class="sd">    streamlined version of the code &quot;enthalpy(SA,CT,p)&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : array_like</span>
<span class="sd">        pressure [dbar]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    enthalpy_SSO_0 : array_like</span>
<span class="sd">                     enthalpy at (SSO, CT=0, p)</span>
<span class="sd">                     [J kg :sup:`-1`]</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import gsw</span>
<span class="sd">    &gt;&gt;&gt; p = np.array([10, 50, 125, 250, 600, 1000])</span>
<span class="sd">    &gt;&gt;&gt; gsw.library.enthalpy_SSO_0(p)</span>
<span class="sd">    array([   97.26388583,   486.27439853,  1215.47517122,  2430.24907325,</span>
<span class="sd">            5827.90879421,  9704.32030926])</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Roquet, F., G. Madec, T.J. McDougall, P.M. Barker, 2015: Accurate</span>
<span class="sd">           polynomial expressions for the density and specifc volume of</span>
<span class="sd">           seawater using the TEOS-10 standard. Ocean Modelling.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">1e-4</span>

    <span class="n">dynamic_enthalpy_SSO_0_p</span> <span class="o">=</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">9.726613854843870e-4</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span>
        <span class="o">-</span><span class="mf">2.252956605630465e-5</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.376909655387404e-6</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span>
            <span class="o">-</span><span class="mf">1.664294869986011e-7</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">5.988108894465758e-9</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">h006</span> <span class="o">+</span> <span class="n">h007</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))))</span>

    <span class="k">return</span> <span class="n">dynamic_enthalpy_SSO_0_p</span> <span class="o">*</span> <span class="n">db2Pascal</span> <span class="o">*</span> <span class="mf">1e4</span></div>


<span class="c1"># FIXME: Check if this is still used and remove it.</span>
<div class="viewcode-block" id="enthalpy_SSO_0_p"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.enthalpy_SSO_0_p">[docs]</a><span class="k">def</span> <span class="nf">enthalpy_SSO_0_p</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates enthalpy at the Standard Ocean Salinty, SSO,</span>
<span class="sd">    and at a Conservative Temperature of zero degrees C, as a function of</span>
<span class="sd">    pressure, p, in dbar, using a streamlined version of the 48-term CT</span>
<span class="sd">    version of the Gibbs function, that is, a streamlined version of the</span>
<span class="sd">    code &quot;enthalpy(SA,CT,p).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import gsw</span>
<span class="sd">    &gt;&gt;&gt; p = np.array([10, 50, 125, 250, 600, 1000])</span>
<span class="sd">    &gt;&gt;&gt; gsw.library.enthalpy_SSO_0_p(p)</span>
<span class="sd">    array([   97.26388276,   486.27439004,  1215.47518168,  2430.24919716,</span>
<span class="sd">            5827.90973888,  9704.32296903])</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] McDougall T.J., P.M. Barker, R. Feistel and D.R. Jackett, 2013:  A</span>
<span class="sd">       computationally efficient 48-term expression for the density of seawater</span>
<span class="sd">       in terms of Conservative Temperature, and related properties of</span>
<span class="sd">       seawater.  To be submitted to J. Atm. Ocean. Technol., xx, yyy-zzz.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">v01</span> <span class="o">=</span> <span class="mf">9.998420897506056e+2</span>
    <span class="n">v05</span> <span class="o">=</span> <span class="o">-</span><span class="mf">6.698001071123802</span>
    <span class="n">v08</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.988822378968490e-2</span>
    <span class="n">v12</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.233269627352527e-2</span>
    <span class="n">v15</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.806789763745328e-4</span>
    <span class="n">v17</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.087032500374211e-7</span>
    <span class="n">v20</span> <span class="o">=</span> <span class="mf">1.550932729220080e-10</span>
    <span class="n">v21</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">v26</span> <span class="o">=</span> <span class="o">-</span><span class="mf">7.521448093615448e-3</span>
    <span class="n">v31</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.303308871386421e-5</span>
    <span class="n">v36</span> <span class="o">=</span> <span class="mf">5.419326551148740e-6</span>
    <span class="n">v37</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.742185394906099e-5</span>
    <span class="n">v41</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.105097577149576e-7</span>
    <span class="n">v43</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.119011592875110e-10</span>
    <span class="n">v47</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.200507748551599e-15</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="n">v21</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span> <span class="p">(</span><span class="n">v26</span> <span class="o">+</span> <span class="n">v36</span> <span class="o">*</span> <span class="n">SSO</span> <span class="o">+</span> <span class="n">v31</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SSO</span><span class="p">))</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">v37</span> <span class="o">+</span> <span class="n">v41</span> <span class="o">*</span> <span class="n">SSO</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">v43</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="n">v47</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">v01</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span> <span class="p">(</span><span class="n">v05</span> <span class="o">+</span> <span class="n">v08</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SSO</span><span class="p">))</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">v12</span> <span class="o">+</span> <span class="n">v15</span> <span class="o">*</span> <span class="n">SSO</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">v17</span> <span class="o">+</span> <span class="n">v20</span> <span class="o">*</span> <span class="n">SSO</span>
    <span class="n">b1sq</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">sqrt_disc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b1sq</span> <span class="o">-</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">b2</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">/</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">b0</span><span class="p">)</span> <span class="o">/</span> <span class="n">b2</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">b1sq</span> <span class="o">/</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">b0</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">b1</span><span class="p">)</span> <span class="o">/</span> <span class="n">b2</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">-</span> <span class="n">sqrt_disc</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">sqrt_disc</span>
    <span class="n">part</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">M</span> <span class="o">*</span> <span class="n">b1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b2</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">db2Pascal</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">/</span> <span class="n">b2</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">b2</span> <span class="o">+</span>
            <span class="p">(</span><span class="n">M</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b2</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">part</span> <span class="o">*</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">b2</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">p</span><span class="p">)))))</span></div>


<div class="viewcode-block" id="entropy_part"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.entropy_part">[docs]</a><span class="k">def</span> <span class="nf">entropy_part</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates entropy, except that it does not evaluate any terms that are</span>
<span class="sd">    functions of Absolute Salinity alone.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SA : array_like</span>
<span class="sd">         Absolute salinity [g kg :sup:`-1`]</span>
<span class="sd">    t : array_like</span>
<span class="sd">        in situ temperature [:math:`^\circ` C (ITS-90)]</span>
<span class="sd">    p : array_like</span>
<span class="sd">        pressure [dbar]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    entropy_part : array_like</span>
<span class="sd">                   entropy minus the terms that due to SA alone</span>
<span class="sd">                   [J kg :sup:`-1` K :sup:`-1`]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    By not calculating these terms, which are a function only of Absolute</span>
<span class="sd">    Salinity, several unnecessary computations are avoided (including saving</span>
<span class="sd">    the computation of a natural logarithm). These terms are a necessary part</span>
<span class="sd">    of entropy, but are not needed when calculating potential temperature from</span>
<span class="sd">    in situ temperature.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SA</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">strip_mask</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">SA</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="mf">0.025</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">1e-4</span>
    <span class="n">g03</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">270.983805184062</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">776.153611613101</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
           <span class="p">(</span><span class="o">-</span><span class="mf">196.51255088122</span> <span class="o">+</span> <span class="p">(</span><span class="mf">28.9796526294175</span> <span class="o">-</span> <span class="mf">2.13290083518327</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span>
           <span class="n">z</span><span class="p">)))</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">24715.571866078</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2910.0729080936</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
           <span class="p">(</span><span class="o">-</span><span class="mf">1513.116771538718</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">546.959324647056</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
           <span class="p">(</span><span class="o">-</span><span class="mf">111.1208127634436</span> <span class="o">+</span> <span class="mf">8.68841343834394</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
           <span class="p">(</span><span class="mf">2210.2236124548363</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2017.52334943521</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
           <span class="p">(</span><span class="mf">1498.081172457456</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">718.6359919632359</span> <span class="o">+</span>
           <span class="p">(</span><span class="mf">146.4037555781616</span> <span class="o">-</span> <span class="mf">4.9892131862671505</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
           <span class="p">(</span><span class="o">-</span><span class="mf">592.743745734632</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1591.873781627888</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
           <span class="p">(</span><span class="o">-</span><span class="mf">1207.261522487504</span> <span class="o">+</span> <span class="p">(</span><span class="mf">608.785486935364</span> <span class="o">-</span> <span class="mf">105.4993508931208</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span>
           <span class="n">z</span><span class="p">))</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">290.12956292128547</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">973.091553087975</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
           <span class="p">(</span><span class="mf">602.603274510125</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">276.361526170076</span> <span class="o">+</span> <span class="mf">32.40953340386105</span> <span class="o">*</span>
           <span class="n">z</span><span class="p">)))</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">113.90630790850321</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">21.35571525415769</span> <span class="o">-</span>
           <span class="mf">67.41756835751434</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">381.06836198507096</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
           <span class="p">(</span><span class="o">-</span><span class="mf">133.7383902842754</span> <span class="o">+</span> <span class="mf">49.023632509086724</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))))))</span>

    <span class="n">g08</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">729.116529735046</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">343.956902961561</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
           <span class="p">(</span><span class="mf">124.687671116248</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">31.656964386073</span> <span class="o">+</span> <span class="mf">7.04658803315449</span> <span class="o">*</span>
           <span class="n">z</span><span class="p">))))</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">137.1145018408982</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
           <span class="p">(</span><span class="mf">148.10030845687618</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">68.5590309679152</span> <span class="o">+</span> <span class="mf">12.4848504784754</span> <span class="o">*</span>
           <span class="n">y</span><span class="p">)))</span> <span class="o">-</span> <span class="mf">22.6683558512829</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">175.292041186547</span> <span class="o">+</span>
           <span class="p">(</span><span class="mf">83.1923927801819</span> <span class="o">-</span> <span class="mf">29.483064349429</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
           <span class="p">(</span><span class="o">-</span><span class="mf">86.1329351956084</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">766.116132004952</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
           <span class="p">(</span><span class="o">-</span><span class="mf">108.3834525034224</span> <span class="o">+</span> <span class="mf">51.2796974779828</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
           <span class="p">(</span><span class="o">-</span><span class="mf">30.0682112585625</span> <span class="o">-</span> <span class="mf">1380.9597954037708</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
           <span class="p">(</span><span class="mf">3.50240264723578</span> <span class="o">+</span> <span class="mf">938.26075044542</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
           <span class="p">(</span><span class="mf">1760.062705994408</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">675.802947790203</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
           <span class="p">(</span><span class="mf">365.7041791005036</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">108.30162043765552</span> <span class="o">+</span> <span class="mf">12.78101825083098</span> <span class="o">*</span>
           <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1190.914967948748</span> <span class="o">+</span> <span class="p">(</span><span class="mf">298.904564555024</span> <span class="o">-</span>
           <span class="mf">145.9491676006352</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2082.7344423998043</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
           <span class="p">(</span><span class="o">-</span><span class="mf">614.668925894709</span> <span class="o">+</span> <span class="p">(</span><span class="mf">340.685093521782</span> <span class="o">-</span> <span class="mf">33.3848202979239</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span>
           <span class="n">z</span><span class="p">)))</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1721.528607567954</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">674.819060538734</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
           <span class="p">(</span><span class="o">-</span><span class="mf">356.629112415276</span> <span class="o">+</span> <span class="p">(</span><span class="mf">88.4080716616</span> <span class="o">-</span> <span class="mf">15.84003094423364</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span>
           <span class="n">z</span><span class="p">))))))</span>

    <span class="n">entropy_part</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">g03</span> <span class="o">+</span> <span class="n">g08</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.025</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">entropy_part</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="entropy_part_zerop"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.entropy_part_zerop">[docs]</a><span class="k">def</span> <span class="nf">entropy_part_zerop</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">pt0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates entropy at a sea surface (p = 0 dbar), except that it does</span>
<span class="sd">    not evaluate any terms that are functions of Absolute Salinity alone.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SA : array_like</span>
<span class="sd">         Absolute salinity [g kg :sup:`-1`]</span>
<span class="sd">    pt0 : array_like</span>
<span class="sd">          potential temperature relative to 0 dbar [:math:`^\circ` C (ITS-90)]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    entropy_part_zerop : array_like</span>
<span class="sd">                         [J kg :sup:`-1` K :sup:`-1`]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    By not calculating these terms, which are a function only of Absolute</span>
<span class="sd">    Salinity, several unnecessary computations are avoided (including saving</span>
<span class="sd">    the computation of a natural logarithm). These terms are a necessary part</span>
<span class="sd">    of entropy, but are not needed when calculating potential temperature from</span>
<span class="sd">    in situ temperature.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SA</span><span class="p">,</span> <span class="n">pt0</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">strip_mask</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">pt0</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">SA</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pt0</span> <span class="o">*</span> <span class="mf">0.025</span>
    <span class="n">g03</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">24715.571866078</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2210.2236124548363</span> <span class="o">+</span>
    <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">592.743745734632</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">290.12956292128547</span> <span class="o">+</span>
    <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">113.90630790850321</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="mf">21.35571525415769</span><span class="p">)))))</span>
    <span class="n">g08</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">137.1145018408982</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
    <span class="p">(</span><span class="mf">148.10030845687618</span> <span class="o">+</span>
    <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">68.5590309679152</span> <span class="o">+</span> <span class="mf">12.4848504784754</span> <span class="o">*</span> <span class="n">y</span><span class="p">))))</span> <span class="o">+</span>
    <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">86.1329351956084</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">30.0682112585625</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
    <span class="mf">3.50240264723578</span><span class="p">)))</span> <span class="o">+</span>
    <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1760.062705994408</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">675.802947790203</span> <span class="o">+</span>
    <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">365.7041791005036</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">108.30162043765552</span> <span class="o">+</span>
    <span class="mf">12.78101825083098</span> <span class="o">*</span> <span class="n">y</span><span class="p">)))))</span>
    <span class="n">entropy_part_zerop</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">g03</span> <span class="o">+</span> <span class="n">g08</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.025</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">entropy_part_zerop</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<span class="c1"># FIXME: Check if this is still used and remove it.</span>
<div class="viewcode-block" id="gibbs"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.gibbs">[docs]</a><span class="k">def</span> <span class="nf">gibbs</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">npr</span><span class="p">,</span> <span class="n">SA</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates specific Gibbs energy and its derivatives up to order 2 for</span>
<span class="sd">    seawater.</span>
<span class="sd">    The Gibbs function approach allows the calculation of internal energy,</span>
<span class="sd">    entropy, enthalpy, potential enthalpy and the chemical potentials of</span>
<span class="sd">    seawater as well as the freezing temperature, and the latent heats of</span>
<span class="sd">    freezing and of evaporation. These quantities were not available from</span>
<span class="sd">    EOS-80 but are essential for the accurate accounting of heat in the ocean</span>
<span class="sd">    and for the consistent and accurate treatment of air-sea and ice-sea heat</span>
<span class="sd">    fluxes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ns : int</span>
<span class="sd">         order of SA derivative [0, 1 or 2 ]</span>
<span class="sd">    nt : int</span>
<span class="sd">         order of t derivative [0, 1 or 2 ]</span>
<span class="sd">    npr : int</span>
<span class="sd">          order of p derivative [0, 1 or 2 ]</span>
<span class="sd">    SA : array_like</span>
<span class="sd">         Absolute salinity [g kg :sup:`-1`]</span>
<span class="sd">    t : array_like</span>
<span class="sd">        in situ temperature [:math:`^\circ` C (ITS-90)]</span>
<span class="sd">    p : array_like</span>
<span class="sd">        pressure [dbar]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    gibbs : array_like</span>
<span class="sd">            Specific Gibbs energy or its derivatives.</span>
<span class="sd">            Gibbs energy (ns=nt=npr=0) has units of:</span>
<span class="sd">            [J kg :sup:`-1`]</span>
<span class="sd">            Absolute Salinity derivatives are output in units of:</span>
<span class="sd">            [(J kg :sup:`-1`) (g kg :sup:`-1`) :sup:`-ns`]</span>
<span class="sd">            Temperature derivatives are output in units of:</span>
<span class="sd">            [(J kg :sup:`-1`) K :sup:`-nt`]</span>
<span class="sd">            Pressure derivatives are output in units of:</span>
<span class="sd">            [(J kg :sup:`-1`) Pa :sup:`-npr`]</span>
<span class="sd">            The mixed derivatives are output in units of:</span>
<span class="sd">            [(J kg :sup:`-1`) (g kg :sup:`-1`) :sup:`-ns` K :sup:`-nt`</span>
<span class="sd">            Pa :sup:`-npr`]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The Gibbs function for seawater is that of TEOS-10 (IOC et al., 2010),</span>
<span class="sd">    being the sum of IAPWS-08 for the saline part and IAPWS-09 for the pure</span>
<span class="sd">    water part. These IAPWS releases are the officially blessed IAPWS</span>
<span class="sd">    descriptions of Feistel (2008) and the pure water part of Feistel (2003).</span>
<span class="sd">    Absolute Salinity, SA, in all of the GSW routines is expressed on the</span>
<span class="sd">    Reference-Composition Salinity Scale of 2008 (RCSS-08) of Millero et al.</span>
<span class="sd">    (2008).</span>
<span class="sd">    The derivatives are taken with respect to pressure in Pa, not withstanding</span>
<span class="sd">    that the pressure input into this routine is in dbar.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Feistel, R., 2003: A new extended Gibbs thermodynamic potential of</span>
<span class="sd">       seawater Progr. Oceanogr., 58, 43-114.</span>

<span class="sd">    .. [2] Feistel, R., 2008: A Gibbs function for seawater thermodynamics</span>
<span class="sd">       for -6 to 80 :math:`^\circ` C and salinity up to 120 g kg :sup:`-1`,</span>
<span class="sd">       Deep-Sea Res. I, 55, 1639-1671.</span>

<span class="sd">    .. [3] IAPWS, 2008: Release on the IAPWS Formulation 2008 for the</span>
<span class="sd">       Thermodynamic Properties of Seawater. The International Association for</span>
<span class="sd">       the Properties of Water and Steam. Berlin, Germany, September 2008,</span>
<span class="sd">       available from http://www.iapws.org.  This Release is referred to as</span>
<span class="sd">       IAPWS-08.</span>

<span class="sd">    .. [4] IAPWS, 2009: Supplementary Release on a Computationally Efficient</span>
<span class="sd">       Thermodynamic Formulation for Liquid Water for Oceanographic Use. The</span>
<span class="sd">       International Association for the Properties of Water and Steam.</span>
<span class="sd">       Doorwerth, The Netherlands, September 2009, available from</span>
<span class="sd">       http://www.iapws.org.  This Release is referred to as IAPWS-09.</span>

<span class="sd">    .. [5] IOC, SCOR and IAPSO, 2010: The international thermodynamic equation</span>
<span class="sd">       of seawater - 2010: Calculation and use of thermodynamic properties.</span>
<span class="sd">       Intergovernmental Oceanographic Commission, Manuals and Guides No. 56,</span>
<span class="sd">       UNESCO (English), 196 pp. See section 2.6 and appendices A.6,  G and H.</span>

<span class="sd">    .. [6] Millero, F. J., R. Feistel, D. G. Wright, and T. J. McDougall, 2008:</span>
<span class="sd">       The composition of Standard Seawater and the definition of the</span>
<span class="sd">       Reference-Composition Salinity Scale, Deep-Sea Res. I, 55, 50-72.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SA</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">SA</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">SA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">SA</span><span class="p">)</span>
    <span class="n">nonzero_SA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">SA</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">_SA</span> <span class="o">=</span> <span class="n">SA</span>
    <span class="n">_t</span> <span class="o">=</span> <span class="n">t</span>
    <span class="n">_p</span> <span class="o">=</span> <span class="n">p</span>
    <span class="n">SA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">SA</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">gibbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>  <span class="c1"># Use if all_masked is True</span>
    <span class="n">all_masked</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Ensure a full mask, so we can set elements if necessary.</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">mask_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmaskarray</span><span class="p">(</span><span class="n">_SA</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">_t</span><span class="p">))</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">mask_or</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">_p</span><span class="p">))</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">mask_or</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">SA</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ipos</span> <span class="o">=</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># inpos = ~ipos  # FIXME: Assigned but never used.</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ipos</span><span class="p">):</span>
        <span class="n">ipos</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># More efficient for usual case.</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">SA</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="mf">0.025</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">1e-4</span>  <span class="c1"># The input pressure (p) is sea pressure in units of dbar.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ns</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">npr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">g03</span> <span class="o">=</span> <span class="p">(</span><span class="mf">101.342743139674</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">100015.695367145</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2544.5765420363</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">284.517778446287</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">33.3146754253611</span> <span class="o">+</span> <span class="p">(</span><span class="mf">4.20263108803084</span> <span class="o">-</span> <span class="mf">0.546428511471039</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">5.90578347909402</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">270.983805184062</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">776.153611613101</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">196.51255088122</span> <span class="o">+</span> <span class="p">(</span><span class="mf">28.9796526294175</span> <span class="o">-</span>
        <span class="mf">2.13290083518327</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">12357.785933039</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1455.0364540468</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">756.558385769359</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">273.479662323528</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
        <span class="p">(</span><span class="o">-</span><span class="mf">55.5604063817218</span> <span class="o">+</span> <span class="mf">4.34420671917197</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">736.741204151612</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">672.50778314507</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">499.360390819152</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">239.545330654412</span> <span class="o">+</span> <span class="p">(</span><span class="mf">48.8012518593872</span> <span class="o">-</span>
        <span class="mf">1.66307106208905</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">148.185936433658</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">397.968445406972</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">301.815380621876</span> <span class="o">+</span> <span class="p">(</span><span class="mf">152.196371733841</span> <span class="o">-</span> <span class="mf">26.3748377232802</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span>
        <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">58.0259125842571</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">194.618310617595</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">120.520654902025</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">55.2723052340152</span> <span class="o">+</span>
        <span class="mf">6.48190668077221</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">18.9843846514172</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.05081646487967</span> <span class="o">-</span>
        <span class="mf">9.63108119393062</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">63.5113936641785</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">22.2897317140459</span> <span class="o">+</span>
        <span class="mf">8.17060541818112</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))))))))</span>
        <span class="k">if</span> <span class="n">nonzero_SA</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1416.27648484197</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">3310.49154044839</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">384.794152978599</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">96.5324320107458</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">15.8408172766824</span> <span class="o">-</span> <span class="mf">2.62480156590992</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2432.14662381794</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2025.80115603697</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">543.835333000098</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">68.5572509204491</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">49.3667694856254</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">17.1397577419788</span> <span class="o">+</span>
            <span class="mf">2.49697009569508</span> <span class="o">*</span> <span class="n">y</span><span class="p">)))</span> <span class="o">-</span> <span class="mf">22.6683558512829</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1091.66841042967</span> <span class="o">-</span> <span class="mf">196.028306689776</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">374.60123787784</span> <span class="o">-</span> <span class="mf">48.5891069025409</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span>
            <span class="mf">36.7571622995805</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">36.0284195611086</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">54.7919133532887</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">4.08193978912261</span> <span class="o">-</span>
            <span class="mf">30.1755111971161</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">199.459603073901</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">52.2940909281335</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">68.0444942726459</span> <span class="o">-</span> <span class="mf">3.41251932441282</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">493.407510141682</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">175.292041186547</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">83.1923927801819</span> <span class="o">-</span> <span class="mf">29.483064349429</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">43.0664675978042</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">383.058066002476</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">54.1917262517112</span> <span class="o">+</span> <span class="mf">25.6398487389914</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">10.0227370861875</span> <span class="o">-</span> <span class="mf">460.319931801257</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
            <span class="p">(</span><span class="mf">0.875600661808945</span> <span class="o">+</span> <span class="mf">234.565187611355</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">168.072408311545</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">729.116529735046</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">343.956902961561</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">124.687671116248</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">31.656964386073</span> <span class="o">+</span> <span class="mf">7.04658803315449</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">880.031352997204</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">225.267649263401</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">91.4260447751259</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">21.6603240875311</span> <span class="o">+</span>
            <span class="mf">2.13016970847183</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">297.728741987187</span> <span class="o">+</span> <span class="p">(</span><span class="mf">74.726141138756</span> <span class="o">-</span>
            <span class="mf">36.4872919001588</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">694.244814133268</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">204.889641964903</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">113.561697840594</span> <span class="o">-</span> <span class="mf">11.1282734326413</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">860.764303783977</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">337.409530269367</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">178.314556207638</span> <span class="o">+</span> <span class="p">(</span><span class="mf">44.2040358308</span> <span class="o">-</span>
            <span class="mf">7.92001547211682</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))))</span>
            <span class="n">g08</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x2</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">5812.81456626732</span> <span class="o">+</span> <span class="mf">851.226734946706</span> <span class="o">*</span>
            <span class="n">y</span><span class="p">[</span><span class="n">ipos</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ipos</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">gibbs</span> <span class="o">=</span> <span class="n">g03</span> <span class="o">+</span> <span class="n">g08</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">ns</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">npr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nonzero_SA</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="p">(</span><span class="mf">8645.36753595126</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">6620.98308089678</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">769.588305957198</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">193.0648640214916</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">31.6816345533648</span> <span class="o">-</span> <span class="mf">5.24960313181984</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">7296.43987145382</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8103.20462414788</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2175.341332000392</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">274.2290036817964</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">197.4670779425016</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">68.5590309679152</span> <span class="o">+</span>
            <span class="mf">9.98788038278032</span> <span class="o">*</span> <span class="n">y</span><span class="p">)))</span> <span class="o">-</span> <span class="mf">90.6734234051316</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">5458.34205214835</span> <span class="o">-</span> <span class="mf">980.14153344888</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2247.60742726704</span> <span class="o">-</span> <span class="mf">340.1237483177863</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span>
            <span class="mf">220.542973797483</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">180.142097805543</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">219.1676534131548</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">16.32775915649044</span> <span class="o">-</span>
            <span class="mf">120.7020447884644</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">598.378809221703</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">156.8822727844005</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">204.1334828179377</span> <span class="o">-</span> <span class="mf">10.23755797323846</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1480.222530425046</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">525.876123559641</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">249.57717834054571</span> <span class="o">-</span> <span class="mf">88.449193048287</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">129.1994027934126</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1149.174198007428</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">162.5751787551336</span> <span class="o">+</span> <span class="mf">76.9195462169742</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">30.0682112585625</span> <span class="o">-</span> <span class="mf">1380.9597954037708</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
            <span class="p">(</span><span class="mf">2.626801985426835</span> <span class="o">+</span> <span class="mf">703.695562834065</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1187.3715515697959</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1458.233059470092</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">687.913805923122</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">249.375342232496</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">63.313928772146</span> <span class="o">+</span> <span class="mf">14.09317606630898</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1760.062705994408</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">450.535298526802</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">182.8520895502518</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">43.3206481750622</span> <span class="o">+</span>
            <span class="mf">4.26033941694366</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">595.457483974374</span> <span class="o">+</span> <span class="p">(</span><span class="mf">149.452282277512</span> <span class="o">-</span>
            <span class="mf">72.9745838003176</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1388.489628266536</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">409.779283929806</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">227.123395681188</span> <span class="o">-</span> <span class="mf">22.2565468652826</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1721.528607567954</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">674.819060538734</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">356.629112415276</span> <span class="o">+</span> <span class="p">(</span><span class="mf">88.4080716616</span> <span class="o">-</span>
            <span class="mf">15.84003094423364</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))))</span>
            <span class="n">g08</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span> <span class="o">=</span> <span class="n">g08</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mf">11625.62913253464</span> <span class="o">+</span> <span class="mf">1702.453469893412</span> <span class="o">*</span>
            <span class="n">y</span><span class="p">[</span><span class="n">ipos</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ipos</span><span class="p">])</span>
            <span class="n">gibbs</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">g08</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_masked</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">ns</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">npr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">g03</span> <span class="o">=</span> <span class="p">(</span><span class="mf">5.90578347909402</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">270.983805184062</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">776.153611613101</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">196.51255088122</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">28.9796526294175</span> <span class="o">-</span> <span class="mf">2.13290083518327</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">24715.571866078</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2910.0729080936</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1513.116771538718</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">546.959324647056</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
        <span class="p">(</span><span class="o">-</span><span class="mf">111.1208127634436</span> <span class="o">+</span> <span class="mf">8.68841343834394</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2210.2236124548363</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2017.52334943521</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1498.081172457456</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">718.6359919632359</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">146.4037555781616</span> <span class="o">-</span> <span class="mf">4.9892131862671505</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">592.743745734632</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1591.873781627888</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1207.261522487504</span> <span class="o">+</span> <span class="p">(</span><span class="mf">608.785486935364</span> <span class="o">-</span>
        <span class="mf">105.4993508931208</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">290.12956292128547</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">973.091553087975</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">602.603274510125</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">276.361526170076</span> <span class="o">+</span>
        <span class="mf">32.40953340386105</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">113.90630790850321</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">21.35571525415769</span> <span class="o">-</span>
        <span class="mf">67.41756835751434</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">381.06836198507096</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">133.7383902842754</span> <span class="o">+</span>
        <span class="mf">49.023632509086724</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))))))</span>
        <span class="k">if</span> <span class="n">nonzero_SA</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">168.072408311545</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">729.116529735046</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">343.956902961561</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">124.687671116248</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">31.656964386073</span> <span class="o">+</span> <span class="mf">7.04658803315449</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">493.407510141682</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">543.835333000098</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">196.028306689776</span> <span class="o">+</span> <span class="mf">36.7571622995805</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">137.1145018408982</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">148.10030845687618</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">68.5590309679152</span> <span class="o">+</span> <span class="mf">12.4848504784754</span> <span class="o">*</span> <span class="n">y</span><span class="p">)))</span> <span class="o">-</span>
            <span class="mf">22.6683558512829</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">175.292041186547</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">83.1923927801819</span> <span class="o">-</span> <span class="mf">29.483064349429</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">86.1329351956084</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">766.116132004952</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">108.3834525034224</span> <span class="o">+</span> <span class="mf">51.2796974779828</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">30.0682112585625</span> <span class="o">-</span> <span class="mf">1380.9597954037708</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
            <span class="p">(</span><span class="mf">3.50240264723578</span> <span class="o">+</span> <span class="mf">938.26075044542</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1760.062705994408</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">675.802947790203</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">365.7041791005036</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">108.30162043765552</span> <span class="o">+</span>
            <span class="mf">12.78101825083098</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1190.914967948748</span> <span class="o">+</span> <span class="p">(</span><span class="mf">298.904564555024</span> <span class="o">-</span>
            <span class="mf">145.9491676006352</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2082.7344423998043</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">614.668925894709</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">340.685093521782</span> <span class="o">-</span> <span class="mf">33.3848202979239</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1721.528607567954</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">674.819060538734</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">356.629112415276</span> <span class="o">+</span> <span class="p">(</span><span class="mf">88.4080716616</span> <span class="o">-</span>
            <span class="mf">15.84003094423364</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))))</span>
            <span class="n">g08</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">851.226734946706</span> <span class="o">*</span> <span class="n">x2</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ipos</span><span class="p">])</span>
            <span class="n">gibbs</span> <span class="o">=</span> <span class="p">(</span><span class="n">g03</span> <span class="o">+</span> <span class="n">g08</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.025</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gibbs</span> <span class="o">=</span> <span class="n">g03</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">ns</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">npr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">g03</span> <span class="o">=</span> <span class="p">(</span><span class="mf">100015.695367145</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">5089.1530840726</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">853.5533353388611</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">133.2587017014444</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">21.0131554401542</span> <span class="o">-</span> <span class="mf">3.278571068826234</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">270.983805184062</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1552.307223226202</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">589.53765264366</span> <span class="o">+</span> <span class="p">(</span><span class="mf">115.91861051767</span> <span class="o">-</span>
        <span class="mf">10.664504175916349</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1455.0364540468</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1513.116771538718</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">820.438986970584</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">222.2416255268872</span> <span class="o">+</span>
        <span class="mf">21.72103359585985</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">672.50778314507</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">998.720781638304</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">718.6359919632359</span> <span class="o">+</span> <span class="p">(</span><span class="mf">195.2050074375488</span> <span class="o">-</span>
        <span class="mf">8.31535531044525</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">397.968445406972</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">603.630761243752</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">456.589115201523</span> <span class="o">-</span> <span class="mf">105.4993508931208</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">194.618310617595</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">63.5113936641785</span> <span class="o">-</span>
        <span class="mf">9.63108119393062</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">44.5794634280918</span> <span class="o">+</span> <span class="mf">24.511816254543362</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">241.04130980405</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">165.8169157020456</span> <span class="o">+</span>
        <span class="mf">25.92762672308884</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))))))</span>
        <span class="k">if</span> <span class="n">nonzero_SA</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">3310.49154044839</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">769.588305957198</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">289.5972960322374</span> <span class="o">+</span> <span class="p">(</span><span class="mf">63.3632691067296</span> <span class="o">-</span>
            <span class="mf">13.1240078295496</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">199.459603073901</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">54.7919133532887</span> <span class="o">+</span>
            <span class="mf">36.0284195611086</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">22.6683558512829</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">8.16387957824522</span> <span class="o">-</span> <span class="mf">90.52653359134831</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">104.588181856267</span> <span class="o">+</span> <span class="p">(</span><span class="mf">204.1334828179377</span> <span class="o">-</span>
            <span class="mf">13.65007729765128</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">175.292041186547</span> <span class="o">+</span> <span class="p">(</span><span class="mf">166.3847855603638</span> <span class="o">-</span>
            <span class="mf">88.449193048287</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">383.058066002476</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">460.319931801257</span> <span class="o">+</span>
            <span class="mf">234.565187611355</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">108.3834525034224</span> <span class="o">+</span> <span class="mf">76.9195462169742</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">729.116529735046</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">687.913805923122</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">374.063013348744</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">126.627857544292</span> <span class="o">+</span>
            <span class="mf">35.23294016577245</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">860.764303783977</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">694.244814133268</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">297.728741987187</span> <span class="o">+</span> <span class="p">(</span><span class="mf">149.452282277512</span> <span class="o">-</span>
            <span class="mf">109.46187570047641</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">409.779283929806</span> <span class="o">+</span> <span class="p">(</span><span class="mf">340.685093521782</span> <span class="o">-</span>
            <span class="mf">44.5130937305652</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">674.819060538734</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">534.943668622914</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">176.8161433232</span> <span class="o">-</span> <span class="mf">39.600077360584095</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Pressure derivative of the Gibbs function</span>
        <span class="c1"># in units of (J kg :sup:`-1`) (Pa :sup:`-1`) = m :sup:`3` kg :sup:`-1`</span>
        <span class="n">gibbs</span> <span class="o">=</span> <span class="p">(</span><span class="n">g03</span> <span class="o">+</span> <span class="n">g08</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-8</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">ns</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">npr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nonzero_SA</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1187.3715515697959</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1458.233059470092</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">687.913805923122</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">249.375342232496</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">63.313928772146</span> <span class="o">+</span> <span class="mf">14.09317606630898</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1480.222530425046</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2175.341332000392</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">980.14153344888</span> <span class="o">+</span> <span class="mf">220.542973797483</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">548.4580073635929</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">592.4012338275047</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">274.2361238716608</span> <span class="o">+</span> <span class="mf">49.9394019139016</span> <span class="o">*</span> <span class="n">y</span><span class="p">)))</span> <span class="o">-</span>
            <span class="mf">90.6734234051316</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">525.876123559641</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">249.57717834054571</span> <span class="o">-</span> <span class="mf">88.449193048287</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">258.3988055868252</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2298.348396014856</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">325.1503575102672</span> <span class="o">+</span> <span class="mf">153.8390924339484</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">90.2046337756875</span> <span class="o">-</span> <span class="mf">4142.8793862113125</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
            <span class="p">(</span><span class="mf">10.50720794170734</span> <span class="o">+</span> <span class="mf">2814.78225133626</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3520.125411988816</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1351.605895580406</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">731.4083582010072</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">216.60324087531103</span> <span class="o">+</span>
            <span class="mf">25.56203650166196</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2381.829935897496</span> <span class="o">+</span> <span class="p">(</span><span class="mf">597.809129110048</span> <span class="o">-</span>
            <span class="mf">291.8983352012704</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">4165.4688847996085</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1229.337851789418</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">681.370187043564</span> <span class="o">-</span> <span class="mf">66.7696405958478</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">3443.057215135908</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1349.638121077468</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">713.258224830552</span> <span class="o">+</span> <span class="p">(</span><span class="mf">176.8161433232</span> <span class="o">-</span>
            <span class="mf">31.68006188846728</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))))</span>
            <span class="n">g08</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span> <span class="o">=</span> <span class="n">g08</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1702.453469893412</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ipos</span><span class="p">])</span>
            <span class="n">gibbs</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sfac</span> <span class="o">*</span> <span class="mf">0.025</span> <span class="o">*</span> <span class="n">g08</span>
            <span class="c1"># FIXME: commented by FF, g110 without nan did not pass</span>
            <span class="c1"># mask[inpos] = True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_masked</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">ns</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">npr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">g08</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">6620.98308089678</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1539.176611914396</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">579.1945920644748</span> <span class="o">+</span> <span class="p">(</span><span class="mf">126.7265382134592</span> <span class="o">-</span>
        <span class="mf">26.2480156590992</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">598.378809221703</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">219.1676534131548</span> <span class="o">+</span>
        <span class="mf">180.142097805543</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">90.6734234051316</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span>
        <span class="p">(</span><span class="o">-</span><span class="mf">32.65551831298088</span> <span class="o">-</span> <span class="mf">362.10613436539325</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">313.764545568801</span> <span class="o">+</span> <span class="p">(</span><span class="mf">612.4004484538132</span> <span class="o">-</span>
        <span class="mf">40.95023189295384</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">525.876123559641</span> <span class="o">+</span> <span class="p">(</span><span class="mf">499.15435668109143</span> <span class="o">-</span>
        <span class="mf">265.347579144861</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1149.174198007428</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1380.9597954037708</span> <span class="o">+</span>
        <span class="mf">703.695562834065</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">325.1503575102672</span> <span class="o">+</span> <span class="mf">230.7586386509226</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1458.233059470092</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1375.827611846244</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">748.126026697488</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">253.255715088584</span> <span class="o">+</span>
        <span class="mf">70.4658803315449</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1721.528607567954</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1388.489628266536</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">595.457483974374</span> <span class="o">+</span> <span class="p">(</span><span class="mf">298.904564555024</span> <span class="o">-</span>
        <span class="mf">218.92375140095282</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">819.558567859612</span> <span class="o">+</span> <span class="p">(</span><span class="mf">681.370187043564</span> <span class="o">-</span>
        <span class="mf">89.0261874611304</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1349.638121077468</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1069.887337245828</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">353.6322866464</span> <span class="o">-</span> <span class="mf">79.20015472116819</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))))</span>
        <span class="c1"># Derivative of the Gibbs function is in units of</span>
        <span class="c1"># (m :sup:`3` kg :sup:`-1`) / (g kg :sup:`-1`) = m :sup:`3` g :sup:`-1`</span>
        <span class="c1"># that is, it is the derivative of specific volume with respect to</span>
        <span class="c1"># Absolute Salinity measured in g kg :sup:`-1`</span>
        <span class="n">gibbs</span> <span class="o">=</span> <span class="n">g08</span> <span class="o">*</span> <span class="n">sfac</span> <span class="o">*</span> <span class="mf">0.5e-8</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">ns</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">npr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">g03</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">270.983805184062</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1552.307223226202</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
        <span class="p">(</span><span class="o">-</span><span class="mf">589.53765264366</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">115.91861051767</span> <span class="o">-</span> <span class="mf">10.664504175916349</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2910.0729080936</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">3026.233543077436</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1640.877973941168</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">444.4832510537744</span> <span class="o">+</span>
        <span class="mf">43.4420671917197</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2017.52334943521</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2996.162344914912</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2155.907975889708</span> <span class="o">+</span> <span class="p">(</span><span class="mf">585.6150223126464</span> <span class="o">-</span>
        <span class="mf">24.946065931335752</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1591.873781627888</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2414.523044975008</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">1826.356460806092</span> <span class="o">-</span> <span class="mf">421.9974035724832</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">973.091553087975</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1205.20654902025</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
        <span class="p">(</span><span class="o">-</span><span class="mf">829.084578510228</span> <span class="o">+</span> <span class="mf">129.6381336154442</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">381.06836198507096</span> <span class="o">-</span> <span class="mf">67.41756835751434</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
        <span class="p">(</span><span class="o">-</span><span class="mf">267.4767805685508</span> <span class="o">+</span> <span class="mf">147.07089752726017</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))))))</span>
        <span class="k">if</span> <span class="n">nonzero_SA</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">729.116529735046</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">687.913805923122</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">374.063013348744</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">126.627857544292</span> <span class="o">+</span>
            <span class="mf">35.23294016577245</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">175.292041186547</span> <span class="o">-</span> <span class="mf">22.6683558512829</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">166.3847855603638</span> <span class="o">-</span> <span class="mf">88.449193048287</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">766.116132004952</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1380.9597954037708</span> <span class="o">+</span>
            <span class="mf">938.26075044542</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">216.7669050068448</span> <span class="o">+</span> <span class="mf">153.8390924339484</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1721.528607567954</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2082.7344423998043</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1190.914967948748</span> <span class="o">+</span> <span class="p">(</span><span class="mf">597.809129110048</span> <span class="o">-</span>
            <span class="mf">437.84750280190565</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1229.337851789418</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1022.055280565346</span> <span class="o">-</span>
            <span class="mf">133.5392811916956</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1349.638121077468</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1069.887337245828</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">353.6322866464</span> <span class="o">-</span> <span class="mf">79.20015472116819</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Derivative of the Gibbs function is in units of (m :sup:`3` (K kg))</span>
        <span class="c1"># that is, the pressure of the derivative in Pa.</span>
        <span class="n">gibbs</span> <span class="o">=</span> <span class="p">(</span><span class="n">g03</span> <span class="o">+</span> <span class="n">g08</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.5e-10</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">ns</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">npr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">g08</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8103.20462414788</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2175.341332000392</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">274.2290036817964</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">197.4670779425016</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">68.5590309679152</span> <span class="o">+</span>
        <span class="mf">9.98788038278032</span> <span class="o">*</span> <span class="n">y</span><span class="p">)))</span> <span class="o">-</span> <span class="mf">90.6734234051316</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="mf">1.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">5458.34205214835</span> <span class="o">-</span> <span class="mf">980.14153344888</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2247.60742726704</span> <span class="o">-</span> <span class="mf">340.1237483177863</span> <span class="o">*</span> <span class="mf">1.25</span> <span class="o">*</span>
        <span class="n">x</span> <span class="o">+</span> <span class="mf">220.542973797483</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span>
        <span class="mf">180.142097805543</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">219.1676534131548</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">16.32775915649044</span> <span class="o">-</span>
        <span class="mf">120.7020447884644</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nonzero_SA</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mf">7296.43987145382</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">598.378809221703</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">156.8822727844005</span> <span class="o">+</span> <span class="p">(</span><span class="mf">204.1334828179377</span> <span class="o">-</span>
            <span class="mf">10.23755797323846</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1480.222530425046</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">525.876123559641</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">249.57717834054571</span> <span class="o">-</span> <span class="mf">88.449193048287</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">129.1994027934126</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1149.174198007428</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">162.5751787551336</span> <span class="o">+</span> <span class="mf">76.9195462169742</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">30.0682112585625</span> <span class="o">-</span> <span class="mf">1380.9597954037708</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.626801985426835</span> <span class="o">+</span> <span class="mf">703.695562834065</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))))</span> <span class="o">/</span> <span class="n">x</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">11625.62913253464</span> <span class="o">+</span> <span class="mf">1702.453469893412</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">x2</span><span class="p">)</span>
            <span class="n">g08</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span>
        <span class="n">gibbs</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">sfac</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">g08</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">ns</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nt</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">npr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">g03</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">24715.571866078</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2910.0729080936</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
        <span class="p">(</span><span class="o">-</span><span class="mf">1513.116771538718</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">546.959324647056</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span>
        <span class="p">(</span><span class="o">-</span><span class="mf">111.1208127634436</span> <span class="o">+</span> <span class="mf">8.68841343834394</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">4420.4472249096725</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">4035.04669887042</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2996.162344914912</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1437.2719839264719</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">292.8075111563232</span> <span class="o">-</span> <span class="mf">9.978426372534301</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1778.231237203896</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">4775.621344883664</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">3621.784567462512</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1826.356460806092</span> <span class="o">-</span>
        <span class="mf">316.49805267936244</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1160.5182516851419</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">3892.3662123519</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2410.4130980405</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1105.446104680304</span> <span class="o">+</span>
        <span class="mf">129.6381336154442</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">569.531539542516</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">128.13429152494615</span> <span class="o">-</span>
        <span class="mf">404.50541014508605</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1905.341809925355</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">668.691951421377</span> <span class="o">+</span>
        <span class="mf">245.11816254543362</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))))))</span>
        <span class="k">if</span> <span class="n">nonzero_SA</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1760.062705994408</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">86.1329351956084</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">137.1145018408982</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">296.20061691375236</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">205.67709290374563</span> <span class="o">+</span> <span class="mf">49.9394019139016</span> <span class="o">*</span> <span class="n">y</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">766.116132004952</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">108.3834525034224</span> <span class="o">+</span>
            <span class="mf">51.2796974779828</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.136422517125</span> <span class="o">-</span> <span class="mf">2761.9195908075417</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">10.50720794170734</span> <span class="o">+</span> <span class="mf">2814.78225133626</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1351.605895580406</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1097.1125373015109</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">433.20648175062206</span> <span class="o">+</span> <span class="mf">63.905091254154904</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">3572.7449038462437</span> <span class="o">+</span> <span class="p">(</span><span class="mf">896.713693665072</span> <span class="o">-</span>
            <span class="mf">437.84750280190565</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">4165.4688847996085</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1229.337851789418</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">681.370187043564</span> <span class="o">-</span> <span class="mf">66.7696405958478</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1721.528607567954</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">674.819060538734</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">356.629112415276</span> <span class="o">+</span> <span class="p">(</span><span class="mf">88.4080716616</span> <span class="o">-</span>
            <span class="mf">15.84003094423364</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">gibbs</span> <span class="o">=</span> <span class="p">(</span><span class="n">g03</span> <span class="o">+</span> <span class="n">g08</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.000625</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">ns</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">npr</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">g03</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">5089.1530840726</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1707.1066706777221</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">399.7761051043332</span> <span class="o">+</span> <span class="p">(</span><span class="mf">84.0526217606168</span> <span class="o">-</span>
        <span class="mf">16.39285534413117</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1552.307223226202</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1179.07530528732</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">347.75583155301</span> <span class="o">-</span> <span class="mf">42.658016703665396</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1513.116771538718</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1640.877973941168</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">666.7248765806615</span> <span class="o">+</span> <span class="mf">86.8841343834394</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">998.720781638304</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1437.2719839264719</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">585.6150223126464</span> <span class="o">-</span> <span class="mf">33.261421241781</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">603.630761243752</span> <span class="o">+</span> <span class="p">(</span><span class="mf">913.178230403046</span> <span class="o">-</span>
        <span class="mf">316.49805267936244</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span>
        <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">241.04130980405</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">44.5794634280918</span> <span class="o">+</span>
        <span class="mf">49.023632509086724</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
        <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">331.6338314040912</span> <span class="o">+</span> <span class="mf">77.78288016926652</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))))))</span>
        <span class="k">if</span> <span class="n">nonzero_SA</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">769.588305957198</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">579.1945920644748</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">190.08980732018878</span> <span class="o">-</span> <span class="mf">52.4960313181984</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">104.588181856267</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">8.16387957824522</span> <span class="o">-</span>
            <span class="mf">181.05306718269662</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">408.2669656358754</span> <span class="o">-</span> <span class="mf">40.95023189295384</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">166.3847855603638</span> <span class="o">-</span> <span class="mf">176.898386096574</span> <span class="o">*</span> <span class="n">z</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">108.3834525034224</span> <span class="o">+</span> <span class="mf">153.8390924339484</span> <span class="o">*</span> <span class="n">z</span><span class="p">)))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">687.913805923122</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="mf">748.126026697488</span> <span class="o">+</span>
            <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">379.883572632876</span> <span class="o">+</span> <span class="mf">140.9317606630898</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">674.819060538734</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1069.887337245828</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">530.4484299696</span> <span class="o">-</span> <span class="mf">158.40030944233638</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">409.779283929806</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">149.452282277512</span> <span class="o">-</span>
            <span class="mf">218.92375140095282</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">681.370187043564</span> <span class="o">-</span> <span class="mf">133.5392811916956</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g08</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Second derivative of the Gibbs function with respect to pressure,</span>
        <span class="c1"># measured in Pa; units of (J kg :sup:`-1`) (Pa :sup:`-2`).</span>
        <span class="n">gibbs</span> <span class="o">=</span> <span class="p">(</span><span class="n">g03</span> <span class="o">+</span> <span class="n">g08</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-16</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal derivative of the Gibbs function&#39;</span><span class="p">)</span>
    <span class="n">gibbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gibbs</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># BÅ: Code below is not needed?  EF: it is needed.</span>
    <span class="k">if</span> <span class="n">all_masked</span><span class="p">:</span>
        <span class="n">gibbs</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
    <span class="c1"># Do not allow zero salinity with salinity derivatives</span>
    <span class="k">if</span> <span class="n">ns</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gibbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">SA</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gibbs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gibbs</span></div>


<div class="viewcode-block" id="gibbs_pt0_pt0"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.gibbs_pt0_pt0">[docs]</a><span class="k">def</span> <span class="nf">gibbs_pt0_pt0</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">pt0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the second derivative of the specific Gibbs function with</span>
<span class="sd">    respect to temperature at zero sea pressure or _gibbs(0,2,0,SA,t,0).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SA : array_like</span>
<span class="sd">         Absolute salinity [g kg :sup:`-1`]</span>
<span class="sd">    pt0 : array_like</span>
<span class="sd">          potential temperature relative to 0 dbar [:math:`^\circ` C (ITS-90)]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    gibbs_pt0_pt0 : array_like</span>
<span class="sd">                    TODO: write the eq. for the second derivative of the</span>
<span class="sd">                    specific Gibbs function. FIXME: [units]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This library function is called by both &quot;pt_from_CT(SA,CT)&quot;</span>
<span class="sd">    and &quot;pt0_from_t(SA,t,p)&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SA</span><span class="p">,</span> <span class="n">pt0</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">strip_mask</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">pt0</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">sfac</span> <span class="o">*</span> <span class="n">SA</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">pt0</span> <span class="o">*</span> <span class="mf">0.025</span>
    <span class="n">g03</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">24715.571866078</span> <span class="o">+</span>
           <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">4420.4472249096725</span> <span class="o">+</span>
           <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1778.231237203896</span> <span class="o">+</span>
           <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1160.5182516851419</span> <span class="o">+</span>
           <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">569.531539542516</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="mf">128.13429152494615</span><span class="p">)))))</span>

    <span class="n">g08</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1760.062705994408</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">86.1329351956084</span> <span class="o">+</span>
           <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">137.1145018408982</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">296.20061691375236</span> <span class="o">+</span>
           <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">205.67709290374563</span> <span class="o">+</span> <span class="mf">49.9394019139016</span> <span class="o">*</span> <span class="n">y</span><span class="p">)))</span> <span class="o">+</span>
           <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.136422517125</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="mf">10.50720794170734</span><span class="p">))</span> <span class="o">+</span>
           <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1351.605895580406</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1097.1125373015109</span> <span class="o">+</span>
           <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">433.20648175062206</span> <span class="o">+</span> <span class="mf">63.905091254154904</span> <span class="o">*</span> <span class="n">y</span><span class="p">)))))</span>
    <span class="n">gibbs_pt0_pt0</span> <span class="o">=</span> <span class="p">(</span><span class="n">g03</span> <span class="o">+</span> <span class="n">g08</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.000625</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gibbs_pt0_pt0</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">in_Baltic</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if positions are in the Baltic Sea</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lon, lat : array_like or masked arrays</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    in_Baltic : boolean array (at least 1D)</span>
<span class="sd">                True for points in the Baltic Sea</span>
<span class="sd">                False for points outside, masked or NaN</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
    <span class="c1"># Polygon bounding the Baltic, (xb, yb)</span>
    <span class="c1"># Effective boundary is the intersection of this polygon</span>
    <span class="c1"># with rectangle defined by xmin, xmax, ymin, ymax</span>

    <span class="c1"># start with southwestern point and go round cyclonically</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.6</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span>  <span class="mf">7.0</span><span class="p">,</span> <span class="mf">12.6</span><span class="p">])</span>
    <span class="n">yb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">69.0</span><span class="p">,</span> <span class="mf">59.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">])</span>
    <span class="c1"># Enclosing rectangle</span>
    <span class="c1"># xmin, xmax = xb.min(), xb.max()</span>
    <span class="c1"># ymin, ymax = yb.min(), yb.max()</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">32.0</span>
    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mf">52.0</span><span class="p">,</span> <span class="mf">67.0</span>
    <span class="c1"># First check if outside the rectangle</span>
    <span class="n">in_rectangle</span> <span class="o">=</span> <span class="p">((</span><span class="n">xmin</span> <span class="o">&lt;</span> <span class="n">lon</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">ymin</span> <span class="o">&lt;</span> <span class="n">lat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">ymax</span><span class="p">))</span>
    <span class="c1"># Masked values are also considered outside the rectangle</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">in_rectangle</span><span class="p">):</span>
        <span class="n">in_rectangle</span> <span class="o">=</span> <span class="n">in_rectangle</span><span class="o">.</span><span class="n">data</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">in_rectangle</span><span class="o">.</span><span class="n">mask</span>
    <span class="c1"># Closer check for points in the rectangle</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">in_rectangle</span><span class="p">):</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">subok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">in_baltic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
        <span class="n">lon1</span> <span class="o">=</span> <span class="n">lon</span><span class="p">[</span><span class="n">in_rectangle</span><span class="p">]</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="n">lat</span><span class="p">[</span><span class="n">in_rectangle</span><span class="p">]</span>
        <span class="c1"># There are general ways of testing for point in polygon</span>
        <span class="c1"># This works for this special configuration of points</span>
        <span class="n">xx_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lat1</span><span class="p">,</span> <span class="n">yb</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">xb</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">xx_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lat1</span><span class="p">,</span> <span class="n">yb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">xb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">in_baltic</span><span class="p">[</span><span class="n">in_rectangle</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">xx_left</span> <span class="o">&lt;=</span> <span class="n">lon1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon1</span> <span class="o">&lt;=</span> <span class="n">xx_right</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">in_baltic</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Nothing inside the rectangle, return the False array.</span>
        <span class="k">return</span> <span class="n">in_rectangle</span>


<div class="viewcode-block" id="infunnel"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.infunnel">[docs]</a><span class="k">def</span> <span class="nf">infunnel</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">CT</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Oceanographic funnel check for the 25-term equation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SA : array_like</span>
<span class="sd">         Absolute Salinity            [g/kg]</span>
<span class="sd">    CT : array_like</span>
<span class="sd">         Conservative Temperature     [°C]</span>
<span class="sd">    p  : array_like</span>
<span class="sd">         sea pressure                 [dbar]</span>
<span class="sd">           (ie. absolute pressure - 10.1325 dbar)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    in_funnel : boolean ndarray or scalar</span>
<span class="sd">        True,  if SA, CT and p are inside the &quot;funnel&quot;</span>
<span class="sd">        False, if SA, CT and p are outside the &quot;funnel&quot;,</span>
<span class="sd">               or one of the values are NaN or masked</span>
<span class="sd">    Note. The term &quot;funnel&quot; describes the range of SA, CT and p over which</span>
<span class="sd">    the error in the fit of the computationally-efficient 25-term</span>
<span class="sd">    expression for density in terms of SA, CT and p was calculated</span>
<span class="sd">    (McDougall et al., 2010).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check variables and re-size if necessary.</span>
    <span class="n">scalar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">SA</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">CT</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">SA</span><span class="p">,</span> <span class="n">CT</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">CT</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">subok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">input_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">SA</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">CT</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">infunnel</span> <span class="o">=</span> <span class="p">((</span><span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">8000</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">SA</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">SA</span> <span class="o">&lt;=</span> <span class="mf">42.2</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">CT</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.3595467</span> <span class="o">-</span> <span class="mf">0.0553734</span> <span class="o">*</span> <span class="n">SA</span><span class="p">))</span> <span class="o">&amp;</span>
                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">5500</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&gt;=</span> <span class="mf">0.006028</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">500</span><span class="p">)))</span> <span class="o">&amp;</span>
                <span class="p">((</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">5500</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="mf">33.0</span> <span class="o">-</span> <span class="mf">0.003818181818182</span> <span class="o">*</span> <span class="n">p</span><span class="p">)))</span> <span class="o">&amp;</span>
                <span class="p">((</span><span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">5500</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">SA</span> <span class="o">&gt;=</span> <span class="mf">30.14</span><span class="p">))</span> <span class="o">&amp;</span>
                <span class="p">((</span><span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">5500</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">CT</span> <span class="o">&lt;=</span> <span class="mf">12.0</span><span class="p">)))</span>
    <span class="n">infunnel</span> <span class="o">=</span> <span class="n">infunnel</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">input_nan</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scalar</span><span class="p">:</span>
        <span class="n">infunnel</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">infunnel</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">infunnel</span></div>


<div class="viewcode-block" id="interp_SA_CT"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.interp_SA_CT">[docs]</a><span class="k">def</span> <span class="nf">interp_SA_CT</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">CT</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p_i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    function [SA_i, CT_i] = interp_SA_CT(SA,CT,p,p_i)</span>
<span class="sd">    interp_SA_CT                    linear interpolation to p_i on a cast</span>
<span class="sd">    ==========================================================================</span>
<span class="sd">    This function interpolates the cast with respect to the interpolating</span>
<span class="sd">    variable p. This function finds the values of SA, CT at p_i on this cast.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">interp_S_T</span><span class="p">(</span><span class="n">SA</span><span class="p">,</span> <span class="n">CT</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p_i</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">interp_S_T</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">znew</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Linear interpolation of ndarrays *S* and *T* from *z* to *znew*.</span>
<span class="sd">    Optionally interpolate a third ndarray, *P*.</span>
<span class="sd">    *z* must be strictly increasing or strictly decreasing.  It must</span>
<span class="sd">    be a 1-D array, and its length must match the last dimension</span>
<span class="sd">    of *S* and *T*.</span>
<span class="sd">    *znew* may be a scalar or a sequence.</span>
<span class="sd">    It is assumed, but not checked, that *S*, *T*, and *z* are</span>
<span class="sd">    all plain ndarrays, not masked arrays or other sequences.</span>
<span class="sd">    Out-of-range values of *znew*, and *nan* in *S* and *T*,</span>
<span class="sd">    yield corresponding *nan* in the output.</span>
<span class="sd">    The basic algorithm is from scipy.interpolate.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">isscalar</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">znew</span><span class="p">):</span>
        <span class="n">isscalar</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">znew</span> <span class="o">=</span> <span class="p">[</span><span class="n">znew</span><span class="p">]</span>
    <span class="n">znew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">znew</span><span class="p">)</span>
    <span class="n">inverted</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">inverted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">P</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;z must be strictly increasing or decreasing&quot;</span><span class="p">)</span>
    <span class="n">hi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">znew</span><span class="p">)</span>
    <span class="n">hi</span> <span class="o">=</span> <span class="n">hi</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">lo</span> <span class="o">=</span> <span class="n">hi</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">z_lo</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">lo</span><span class="p">]</span>
    <span class="n">z_hi</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">hi</span><span class="p">]</span>
    <span class="n">S_lo</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">lo</span><span class="p">]</span>
    <span class="n">S_hi</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">hi</span><span class="p">]</span>
    <span class="n">T_lo</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">lo</span><span class="p">]</span>
    <span class="n">T_hi</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">hi</span><span class="p">]</span>
    <span class="n">zratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">znew</span> <span class="o">-</span> <span class="n">z_lo</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">z_hi</span> <span class="o">-</span> <span class="n">z_lo</span><span class="p">)</span>
    <span class="n">Si</span> <span class="o">=</span> <span class="n">S_lo</span> <span class="o">+</span> <span class="p">(</span><span class="n">S_hi</span> <span class="o">-</span> <span class="n">S_lo</span><span class="p">)</span> <span class="o">*</span> <span class="n">zratio</span>
    <span class="n">Ti</span> <span class="o">=</span> <span class="n">T_lo</span> <span class="o">+</span> <span class="p">(</span><span class="n">T_hi</span> <span class="o">-</span> <span class="n">T_lo</span><span class="p">)</span> <span class="o">*</span> <span class="n">zratio</span>
    <span class="k">if</span> <span class="n">P</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Pi</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">lo</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">hi</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">lo</span><span class="p">])</span> <span class="o">*</span> <span class="n">zratio</span>
    <span class="k">if</span> <span class="n">inverted</span><span class="p">:</span>
        <span class="n">Si</span> <span class="o">=</span> <span class="n">Si</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Ti</span> <span class="o">=</span> <span class="n">Ti</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">P</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Pi</span> <span class="o">=</span> <span class="n">Pi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">outside</span> <span class="o">=</span> <span class="p">(</span><span class="n">znew</span> <span class="o">&lt;</span> <span class="n">z</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">|</span> <span class="p">(</span><span class="n">znew</span> <span class="o">&gt;</span> <span class="n">z</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">outside</span><span class="p">):</span>
        <span class="n">Si</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">outside</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">Ti</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">outside</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">P</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Pi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">outside</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">if</span> <span class="n">isscalar</span><span class="p">:</span>
        <span class="n">Si</span> <span class="o">=</span> <span class="n">Si</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Ti</span> <span class="o">=</span> <span class="n">Ti</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">P</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Pi</span> <span class="o">=</span> <span class="n">Pi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">P</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Si</span><span class="p">,</span> <span class="n">Ti</span>
    <span class="k">return</span> <span class="n">Si</span><span class="p">,</span> <span class="n">Ti</span><span class="p">,</span> <span class="n">Pi</span>


<div class="viewcode-block" id="interp_ref_cast"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.interp_ref_cast">[docs]</a><span class="k">def</span> <span class="nf">interp_ref_cast</span><span class="p">(</span><span class="n">spycnl</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="s2">&quot;gn&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translation of:</span>
<span class="sd">    [SA_iref_cast, CT_iref_cast, p_iref_cast] = interp_ref_cast(spycnl, A)</span>
<span class="sd">    interp_ref_cast            linear interpolation of the reference cast</span>
<span class="sd">    ==========================================================================</span>
<span class="sd">    This function interpolates the reference cast with respect to the</span>
<span class="sd">    interpolating variable &quot;spycnl&quot;.  This reference cast is at the location</span>
<span class="sd">    188E,4N from the reference data set which underlies the Jackett &amp;</span>
<span class="sd">    McDougall (1997) Neutral Density computer code.  This function finds the</span>
<span class="sd">    values of SA, CT and p on this reference cast which correspond to the</span>
<span class="sd">    value of isopycnal which is passed to this function from the function</span>
<span class="sd">    &quot;geo_strf_isopycnal_CT&quot;.  The isopycnal could be either gamma_n or</span>
<span class="sd">    sigma_2. If A is set to any of the following &#39;s2&#39;,&#39;S2&#39;,&#39;sigma2&#39;,&#39;sigma_2&#39;</span>
<span class="sd">    the interpolation will take place in sigma 2 space, any other input</span>
<span class="sd">    will result in the programme working in gamma_n space.</span>
<span class="sd">    VERSION NUMBER: 3.0 (14th April, 2011)</span>
<span class="sd">    REFERENCE:</span>
<span class="sd">    Jackett, D. R. and T. J. McDougall, 1997: A neutral density variable</span>
<span class="sd">    for the world&lt;92&gt;s oceans. Journal of Physical Oceanography, 27, 237-263.</span>
<span class="sd">    FIXME? Do we need argument checking here to handle masked arrays,</span>
<span class="sd">    etc.?  I suspect not, since I don&#39;t think this is intended to be</span>
<span class="sd">    user-callable, but is instead used internally by user-callable</span>
<span class="sd">    functions.</span>
<span class="sd">    Note: The v3.03 matlab code is incorrectly using approximate numbers</span>
<span class="sd">    for the gamma_n case, even when the sigma_2 case is in effect.</span>
<span class="sd">    That bug is fixed here.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;s2&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma2&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma_2&quot;</span><span class="p">]:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="s2">&quot;s2&quot;</span>
    <span class="n">gsw_data</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="s2">&quot;gsw_data_v3_0.npz&quot;</span><span class="p">)</span>
    <span class="n">SA_ref</span> <span class="o">=</span> <span class="n">gsw_data</span><span class="o">.</span><span class="n">SA_ref_cast</span>
    <span class="n">CT_ref</span> <span class="o">=</span> <span class="n">gsw_data</span><span class="o">.</span><span class="n">CT_ref_cast</span>
    <span class="n">p_ref</span> <span class="o">=</span> <span class="n">gsw_data</span><span class="o">.</span><span class="n">p_ref_cast</span>
    <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="s2">&quot;s2&quot;</span><span class="p">:</span>
        <span class="n">zvar_ref</span> <span class="o">=</span> <span class="n">gsw_data</span><span class="o">.</span><span class="n">sigma_2_ref_cast</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zvar_ref</span> <span class="o">=</span> <span class="n">gsw_data</span><span class="o">.</span><span class="n">gamma_n_ref_cast</span>
    <span class="n">zvar_new</span> <span class="o">=</span> <span class="n">spycnl</span>
    <span class="n">Si</span><span class="p">,</span> <span class="n">Ci</span><span class="p">,</span> <span class="n">Pi</span> <span class="o">=</span> <span class="n">interp_S_T</span><span class="p">(</span><span class="n">SA_ref</span><span class="p">,</span> <span class="n">CT_ref</span><span class="p">,</span> <span class="n">zvar_ref</span><span class="p">,</span> <span class="n">zvar_new</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">p_ref</span><span class="p">)</span>
    <span class="n">shallower</span> <span class="o">=</span> <span class="n">spycnl</span> <span class="o">&lt;=</span> <span class="n">zvar_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">deeper</span> <span class="o">=</span> <span class="n">spycnl</span> <span class="o">&gt;=</span> <span class="n">zvar_ref</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">shallower</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">Si</span><span class="p">[</span><span class="n">shallower</span><span class="p">]</span> <span class="o">=</span> <span class="n">SA_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Ci</span><span class="p">[</span><span class="n">shallower</span><span class="p">]</span> <span class="o">=</span> <span class="n">CT_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Pi</span><span class="p">[</span><span class="n">shallower</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">deeper</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">Si</span><span class="p">[</span><span class="n">deeper</span><span class="p">]</span> <span class="o">=</span> <span class="n">SA_ref</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Ci</span><span class="p">[</span><span class="n">deeper</span><span class="p">]</span> <span class="o">=</span> <span class="n">CT_ref</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Pi</span><span class="p">[</span><span class="n">deeper</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_ref</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Si</span><span class="p">,</span> <span class="n">Ci</span><span class="p">,</span> <span class="n">Pi</span></div>


<span class="k">def</span> <span class="nf">specvol_SSO_0_CT25</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates specific volume at the Standard Ocean Salinity (SSO) and</span>
<span class="sd">    Conservative Temperature of zero degrees C (CT=0), as a function of</span>
<span class="sd">    pressure (p [dbar]) or spec_vol_CT25(35.16504,0,p).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : array_like</span>
<span class="sd">        pressure [dbar]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    specvol_SSO_0_CT25 : array_like</span>
<span class="sd">                         Specific volume at (SSO, CT=0, p), 25-term equation.</span>
<span class="sd">                         [m :sup:`3` kg :sup:`-1`]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    It uses a streamlined version of the 25-term CT version of specific volume</span>
<span class="sd">    that is, a streamlined version of the code &quot;rho_alpha_beta_CT25(SA,CT,p)&quot;</span>
<span class="sd">    Modifications</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="c1"># No need to strip mask and replace it here; the calculation is simple.</span>
    <span class="n">specvol_SSO_0_CT25</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0777716085618458e-003</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SSO</span><span class="p">)</span> <span class="o">*</span>
                          <span class="mf">3.4688210757917340e-006</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span>
                           <span class="mf">6.8314629554123324e-006</span><span class="p">)</span> <span class="o">/</span>
                          <span class="p">(</span><span class="mf">9.9984380290708214e+002</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span>
                           <span class="p">(</span><span class="mf">2.8925731541277653e+000</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span>
                            <span class="mf">1.9457531751183059e-003</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span>
                           <span class="p">(</span><span class="mf">1.1930681818531748e-002</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span>
                            <span class="mf">5.9355685925035653e-006</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span>
                            <span class="o">-</span><span class="mf">2.5943389807429039e-008</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">specvol_SSO_0_CT25</span>


<span class="c1"># Salinity lib functions.</span>
<div class="viewcode-block" id="specvol_SSO_0_p"><a class="viewcode-back" href="../../../gsw.gibbs.html#gsw.specvol_SSO_0_p">[docs]</a><span class="k">def</span> <span class="nf">specvol_SSO_0_p</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates specific volume at the Standard Ocean</span>
<span class="sd">    Salinity, SSO, and at a Conservative Temperature of zero degrees C, as a</span>
<span class="sd">    function of pressure, p, in dbar, using a streamlined version of the</span>
<span class="sd">    48-term CT version of specific volume, that is, a streamlined version of</span>
<span class="sd">    the code &quot;specvol(SA, CT, p)&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">v01</span> <span class="o">=</span> <span class="mf">9.998420897506056e+2</span>
    <span class="n">v05</span> <span class="o">=</span> <span class="o">-</span><span class="mf">6.698001071123802</span>
    <span class="n">v08</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.988822378968490e-2</span>
    <span class="n">v12</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.233269627352527e-2</span>
    <span class="n">v15</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.806789763745328e-4</span>
    <span class="n">v17</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.087032500374211e-7</span>
    <span class="n">v20</span> <span class="o">=</span> <span class="mf">1.550932729220080e-10</span>
    <span class="n">v21</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">v26</span> <span class="o">=</span> <span class="o">-</span><span class="mf">7.521448093615448e-3</span>
    <span class="n">v31</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.303308871386421e-5</span>
    <span class="n">v36</span> <span class="o">=</span> <span class="mf">5.419326551148740e-6</span>
    <span class="n">v37</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.742185394906099e-5</span>
    <span class="n">v41</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.105097577149576e-7</span>
    <span class="n">v43</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.119011592875110e-10</span>
    <span class="n">v47</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.200507748551599e-15</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">v21</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span> <span class="p">(</span><span class="n">v26</span> <span class="o">+</span> <span class="n">v36</span> <span class="o">*</span> <span class="n">SSO</span> <span class="o">+</span> <span class="n">v31</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SSO</span><span class="p">))</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">v37</span> <span class="o">+</span> <span class="n">v41</span> <span class="o">*</span> <span class="n">SSO</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">v43</span> <span class="o">+</span> <span class="n">v47</span> <span class="o">*</span> <span class="n">p</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="n">v01</span> <span class="o">+</span> <span class="n">SSO</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">v05</span> <span class="o">+</span> <span class="n">v08</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SSO</span><span class="p">))</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">v12</span> <span class="o">+</span> <span class="n">v15</span> <span class="o">*</span> <span class="n">SSO</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">v17</span> <span class="o">+</span> <span class="n">v20</span> <span class="o">*</span> <span class="n">SSO</span><span class="p">))))</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>